<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Beer Mini‚ÄëApp | Router + BackButton + No‚ÄëSwipe</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --tabH: 64px;
      --navGap: 12px;
      --bg:#0b0c15; --text:#f4f6fa; --border:rgba(255,255,255,.10);
      --amber:#f9b24d; --green:#37d67a; --red:#ff6b6b; --blue:#3d7eff;
      --appW: 428px;
      --wrapPadX: 14px;
      --wrapPadTop: 16px;
    }
    *{ box-sizing:border-box }
    img{ max-width:100%; display:block }
    html,body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      overscroll-behavior: none;
    }
    @media (min-width:900px){ body{ display:grid; place-items:center; } }
    .wrap{
      width:100%; max-width:1080px; margin:0 auto;
      min-height:100svh;
      padding:16px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px);
    }
    @media (min-width:900px){
      .wrap{ max-width:var(--appW); padding:20px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px); }
    }
    main>section, section.page{ display:none }
    main>section.active, section.page.active{ display:block }

    
    .btm-nav{
      position:fixed; left:0; right:0;
      bottom: calc(var(--navGap) + env(safe-area-inset-bottom, 0px));
      height: var(--tabH);
      z-index: 9999;
      display:grid; grid-template-columns:repeat(5,1fr); align-items:center;
      padding: 6px 6px 6px;
      background: rgba(10,12,14,.72);
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      border-left:0; border-right:0; border-bottom:0;
      border-radius: 16px 16px 0 0;
    }
    .btm-nav .tab{
      height:100%; border:0; background:none; color:#dfe3e6; cursor:pointer;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
      font-size:11px; font-weight:700;
      filter: grayscale(.35) saturate(.8); opacity:.85;
      border-radius:14px; -webkit-tap-highlight-color:transparent;
    }
    .btm-nav .tab img{ width:24px; height:24px }
    .btm-nav .tab:active{ transform: translateY(1px) }
    .btm-nav .tab.active{ opacity:1; filter:none; color:#fff; position:relative }
    .btm-nav .tab.active::before{
      content:""; position:absolute; inset:6px 10px 18px 10px; z-index:-1;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    @media (min-width:900px){
      .btm-nav{ left:50%; right:auto; width: var(--appW); transform: translateX(-50%); }
    }

    
    .card{ background:rgba(255,255,255,.05); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .page-title{ margin:0 0 12px }
    .h1{ font-weight:800; font-size:20px; margin:0 0 8px }
    .muted-sm{ opacity:.8 }

    
    .sheet{ position:fixed; inset:0; z-index:9990; pointer-events:none; }
    .sheet.is-open{ pointer-events:auto; }
    .sheet__overlay{
      position:absolute; left:0; right:0; top:0;
      bottom: calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      background: rgba(0,0,0,.48); opacity:0; transition:opacity .2s ease;
      -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
    }
    .sheet.is-open .sheet__overlay{ opacity:1; }
    .sheet__panel{
      position:absolute; left:0; right:0; margin:0 auto;
      width:min(820px,100%); max-height:88vh; overflow:auto;
      background:linear-gradient(180deg, rgba(18,20,24,.98), rgba(18,20,24,.96));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 20px 40px rgba(0,0,0,.45);
      transition: transform .28s cubic-bezier(.2,.8,.2,1), opacity .2s ease;
      padding:12px 14px calc(16px + var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      will-change: transform;
      touch-action: pan-y;
    }
    .sheet.sheet-bottom .sheet__panel{ bottom:0; top:auto; border-radius: 16px 16px 0 0; transform: translateY(100%); }
    .sheet.is-open.sheet-bottom .sheet__panel{ transform: translateY(0); }
    .sheet__handle{ width:42px; height:4px; border-radius:999px; margin:6px auto 10px; background:rgba(255,255,255,.18) }
    .sheet__header{ display:flex; align-items:center; gap:10px; margin:0 0 8px }
    .sheet__title{ font-weight:800; font-size:18px; margin:0 }
    .sheet__close{ margin-left:auto; border:0; background:transparent; color:#fff; opacity:.85; width:36px; height:36px; border-radius:10px; display:grid; place-items:center }
    .sheet__close:active{ transform:translateY(1px); opacity:1 }
    .sheet__body{ display:grid; gap:10px }
    body.sheet-open{ overflow:hidden }
    @media (min-width:900px){ .sheet__panel{ width:min(var(--appW),92vw); } }

    
    .hero{ position: relative; margin: calc(-1 * var(--wrapPadTop)) calc(-1 * var(--wrapPadX)) 14px; padding-top: env(safe-area-inset-top, 0px); background:#000; overflow:hidden; }
    .hero__media{ width:100%; height: clamp(260px, 42vh, 460px); object-fit: cover; display:block; }
    .hero::after{ content:""; position:absolute; left:0; right:0; bottom:-1px; height:84px; pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 100%); }
    @media (min-width:900px){ .hero{ margin-left: calc((var(--appW) - 100vw)/2 - var(--wrapPadX)); margin-right: calc((var(--appW) - 100vw)/2 - var(--wrapPadX)); } }

    
    .promo{ display:grid; grid-template-columns:48px 1fr auto; align-items:center; gap:12px; padding:10px 12px; margin:0 0 12px; background: rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); border-radius:16px; }
    .promo__icon{ width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden }
    .promo__icon img{ width:28px; height:28px; display:block }
    .promo__title{ font-weight:800 }
    .promo__sub{ opacity:.8; font-size:13px; margin-top:2px }
    .promo__btn{ height:36px; padding:0 14px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:linear-gradient(180deg,#f9b24d,#f29117); color:#16181e; font-weight:900; cursor:pointer; }
    .promo__btn:active{ transform: translateY(1px) }

    
    .list-card .list-head{ font:800 16px/1.2 Inter,system-ui; margin-bottom:8px }
    .list{ display:grid; gap:8px }
    .list-card .list__item{ background:transparent; border:0; box-shadow:none }
    .list-card.tight .list{ margin-left:-16px; margin-right:-16px }
    .list-card.tight .list__item{ padding:12px 16px; gap:10px; display:grid; grid-template-columns:36px 1fr auto; align-items:center; }
    .list-card.tight .list__icon{ width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden }
    .list-card.tight .list__icon img{ width:22px; height:22px; display:block }
    .list__text{ display:grid; gap:4px }
    .list__title{ font-weight:800 }
    .list__sub{ opacity:.8; font-size:13px }
    .list__chev-btn{ width:36px; height:36px; display:grid; place-items:center; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:transparent; color:inherit; font-size:18px; cursor:pointer; }
    .list__chev-btn:active{ transform:translateY(1px) }
    .list-card .list__item:hover{ background: rgba(255,255,255,.04) }

    
    .badge{ display:inline-grid; place-items:center; padding:3px 8px; border-radius:999px; font:700 12px/1 Inter; background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); }
    .badge--amber{ background:rgba(249,178,77,.15); border-color:rgba(249,178,77,.35); color:#ffd59c }
    .badge--green{ background:rgba(55,214,122,.15); border-color:rgba(55,214,122,.35); color:#bff5d6 }
    .meter{ height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden }
    .meter>i{ display:block; height:100%; width:0%; background:linear-gradient(90deg,#f9b24d,#f29117); }

    
    .btn{ height:40px; padding:0 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.04); color:#fff; font-weight:800; cursor:pointer }
    .btn:active{ transform: translateY(1px) }
    .btn-primary{ background:linear-gradient(180deg,#f9b24d,#f29117); color:#16181e; border:0 }

    
    .g{ display:grid; gap:10px }
    .g2{ grid-template-columns:1fr 1fr }
    .g3{ grid-template-columns:1fr 1fr 1fr }
    @media (max-width:420px){ .g2,.g3{ grid-template-columns:1fr } }

    
    #cap-area{ touch-action:none; user-select:none; -webkit-user-select:none; position:relative; margin-top:10px; height:260px; border:1px dashed rgba(255,255,255,.18); border-radius:12px; overflow:hidden; background:radial-gradient(120% 120% at 50% 100%, rgba(249,178,77,.12), rgba(255,255,255,.02)); }
    #cap-area canvas{ position:absolute; inset:0; width:100%; height:100%; display:block }
    #cap-area .cap-msg{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); opacity:.8; font-size:14px; text-align:center }

    
    #confetti{ position:fixed; inset:0; pointer-events:none; z-index:99999; }
  </style>

  <style>


:root{ --introBottomPad: 28px; } 

.intro{
  position:fixed; inset:0; z-index:10050;
  background:#000; color:#fff;
  display:none; pointer-events:auto;
}
.intro.is-open{ display:block; }
body.intro-open{ overflow:hidden; }

.intro__wrap{
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  padding:
    calc(env(safe-area-inset-top,0px) + 6px)
    14px
    calc(env(safe-area-inset-bottom,0px) + var(--introBottomPad));
}

.intro__progress{
  display:flex; gap:8px; justify-content:center;
  padding:8px 0 12px;
}
.intro__seg{ width:44px; height:4px; border-radius:999px; background:rgba(255,255,255,.28) }
.intro__seg.active{ background:#fff }

.intro__stage{
  flex:1; display:grid; place-items:center; padding:12px; text-align:center;
}
.intro__slides{ width:100% }
.intro__slide{ display:none }
.intro__slide.active{ display:block }

.intro__h1{ font-weight:900; font-size:28px; margin:0 0 10px }
.intro__p{ opacity:.85; font-size:15px; margin:0 auto; max-width:26ch }


.intro__actions{
  margin-top:auto; display:grid; gap:10px;
  padding-top:8px;
}
.intro__actions--one{ grid-template-columns:1fr }
.intro__actions--two{ grid-template-columns:1fr 1fr }

.intro__btn{
  height:52px; padding:0 16px; border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.intro__btn--primary{ background:#fff; color:#000; border-color:#fff }
.intro__btn--ghost{ background:transparent }
.intro__btn:active{ transform:translateY(1px) }

@media (min-width:900px){
  .intro__wrap{ max-width: var(--appW,428px); margin:0 auto }
}
</style>

<style>
  
.list-card.games .list__item{ background:transparent; border:0; box-shadow:none }
.list__btn{
  height:36px; padding:0 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.list__btn--primary{ background:#fff; color:#000; border-color:#fff }
.list__btn:active{ transform:translateY(1px) }

/* —á—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ —Å–µ—Ç–∫–∞ –ø–æ–¥ –∫–Ω–æ–ø–∫—É —Å–ø—Ä–∞–≤–∞ */
.list-card.games.tight .list__item{
  grid-template-columns:36px 1fr auto;
}
:root{ --gap-block: 16px; }           
.card.list-card.games{ margin-top: var(--gap-block); }

 </style>

 <style>
  
.lb-card { padding:12px; }
.lb-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.lb-title{ font-weight:900; font-size:18px; }
.lb-sub{ opacity:.75; font-weight:600; font-size:12px; }

.lb-seg{
  display:inline-grid; grid-auto-flow:column; gap:6px; padding:4px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
}
.lb-seg button{
  height:30px; min-width:86px; padding:0 12px; border-radius:999px; border:0; cursor:pointer;
  font-weight:800; color:#fff; background:transparent;
}
.lb-seg button[aria-pressed="true"]{ background:#fff; color:#000; }

.lb-you{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  margin-bottom:10px;
}
.lb-you__avatar{
  width:36px; height:36px; border-radius:10px; background:#222; display:grid; place-items:center; font-weight:900;
}
.lb-you__name{ font-weight:800; }
.lb-you__score{ margin-left:auto; font-weight:900; }

.lb-list{ display:flex; flex-direction:column; gap:8px; }
.lb-row{
  display:grid; grid-template-columns:28px 36px 1fr auto; align-items:center; gap:10px;
  padding:10px 12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03); border-radius:14px;
}
.lb-rank{ font-weight:900; opacity:.9; text-align:center; }
.lb-avatar{ width:36px; height:36px; border-radius:10px; background:#1b1c22; display:grid; place-items:center; font-weight:900; }
.lb-name{ font-weight:800; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.lb-score{ font-weight:900; }

.lb-medal-1 .lb-rank{ color:#ffd34d; }
.lb-medal-2 .lb-rank{ color:#cbd3ff; }
.lb-medal-3 .lb-rank{ color:#ffb27a; }

.lb-actions{ display:flex; gap:10px; margin-top:12px; }
.lb-btn{
  flex:1; height:42px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; font-weight:800; cursor:pointer;
}
.lb-btn--primary{ background:#fff; color:#000; border-color:#fff; }

@media (min-width:900px){
  #leaderboard .inner{ max-width: var(--appW, 428px); margin:0 auto; }
}

 </style>

<style>

.flappy{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.flappy.is-open{ display:block; }
body.flappy-open{ overflow:hidden; }

.flappy__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}


.fl-hud{ width:100%; max-width:520px; margin:0 auto 8px; position:relative; z-index:30; } /* ‚Üë –ø–æ–≤–µ—Ä—Ö —Å—Ü–µ–Ω—ã */
.fl-hud__row{ display:grid; justify-items:center; gap:6px; }
.fl-score{ font:900 clamp(28px,8vw,48px)/1 Inter,system-ui; text-shadow:0 2px 10px rgba(0,0,0,.25) }
.fl-bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }


.fl-stats{ display:flex; justify-content:center; gap:14px; margin-top:6px; }
.fl-stat{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); font:800 13px/1 Inter;
}
.fl-ico{ width:18px; height:18px; background:center/contain no-repeat; opacity:.95 }
#fl-coin-count{ font:800 14px/1 Inter }
.fl-shield-wrap{ display:flex; align-items:center; gap:8px; }
.fl-shield-bar{ width:88px; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-shield-bar>i{ display:block; height:100%; width:100%; background:#6be3ff; transform-origin:left center; }


.fl-stage{
  flex:1; position:relative; overflow:hidden; border-radius:16px;
  background: linear-gradient(180deg,#0a0c14 0%, #0f1626 100%);
  z-index:1; /* –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π —Å—Ü–µ–Ω—ã */
}
.fl-hint{
  position:absolute; left:0; right:0; top:18%;
  text-align:center; font:800 16px/1.2 Inter; opacity:.75; pointer-events:none; z-index:15;
}


:root{ --bird-w: 48px; --bird-h: 36px; --pipe-w: 76px; --coin-w: 32px; --coin-h: 32px; --pow-w: 34px; --pow-h: 34px; }


.fl-bird{
  position:absolute; width:var(--bird-w); height:var(--bird-h); transform:translate(-50%,-50%) rotate(0deg);
  background: radial-gradient(circle at 35% 35%, #ffdd66, #ff9a00);
  border-radius:14px; box-shadow:0 8px 18px rgba(255,154,0,.35), inset 0 0 10px rgba(255,255,255,.25);
  will-change: transform, top, left;
  z-index:20; 
}
.fl-bird--sprite{ background:center/contain no-repeat; border-radius:0; box-shadow:none; }
.fl-bird--shield{ box-shadow:0 0 0 3px rgba(107,227,255,.8), 0 0 30px rgba(107,227,255,.55); }


.fl-pipe-part{
  position:absolute; width:var(--pipe-w);
  background: linear-gradient(180deg,#6BFF7A,#1ED760);
  border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 22px rgba(30,215,96,.25), inset 0 0 10px rgba(255,255,255,.15);
  z-index:10; /* –Ω–∏–∂–µ –ø—Ç–∏—Ü—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ */
}
.fl-pipe--sprite{ background: center / 100% 100% no-repeat; border:none; box-shadow:none; }


.fl-coin,.fl-power{
  position:absolute; transform:translate(-50%,-50%); will-change: left, top;
  width:var(--coin-w); height:var(--coin-h); background:center/contain no-repeat;
  z-index:12; 
}
.fl-power{ width:var(--pow-w); height:var(--pow-h); }


.fl-result{
  position:absolute; inset:0; display:none; place-items:center; padding:16px;
  z-index:9999;            
  pointer-events:auto;
}
.fl-result.show{ display:grid; }
.fl-card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.fl-cell{ display:grid; gap:4px; justify-items:center }
.fl-val{ font:800 20px/1 Inter } .fl-sub{ font:600 12px/1.1 Inter; opacity:.8 } .fl-chev{ font:20px/1 Inter; opacity:.6 }


:root{ --ctaGap: 44px; }
.fl-cta{
  position:absolute; left:14px; right:14px;
  bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap));
  display:none; z-index:50; /* –Ω–∞–¥ —Å—Ü–µ–Ω–æ–π, –Ω–æ –ø–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º */
}
.fl-cta.show{ display:block; }
.fl-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .flappy__wrap{ max-width:var(--appW,428px); margin:0 auto } }


:root{
  --bird-radius: 50px;
  --shield-ring: 0px;
  --shield-ring-color: rgba(107,227,255,.95);
  --shield-glow-color: rgba(107,227,255,.55);
  --shield-glow-blur: 28px;
  --shield-pulse: 1.6s;
}


.fl-bird{ border-radius: var(--bird-radius); }

.fl-bird--sprite{ border-radius: var(--bird-radius); }


.fl-bird--shield{
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  position: relative;
}
.fl-bird--shield::after{
  content:"";
  position:absolute; inset: calc(-1*var(--shield-ring));
  border-radius: inherit;
  border: var(--shield-ring) solid var(--shield-ring-color);
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  animation: shieldPulse var(--shield-pulse) ease-in-out infinite;
  pointer-events: none;
}

@keyframes shieldPulse{
  0%  { box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,.35); }
  60% { box-shadow: 0 0 calc(var(--shield-glow-blur)*1.2) var(--shield-glow-color), 0 0 0 10px rgba(107,227,255,0); }
  100%{ box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,0); }
}


.flappy, .flappy * { font-family: inherit !important; }

</style>


  <style>
    

    
    #bonuses>.card {
      margin-top: 14px;
    }

    #bonuses>.card:first-child {
      margin-top: 0;
    }

    
    #bonuses .bonus-card {
      padding: 14px;
      overflow: hidden;
    }

    #bonuses .bonus-card .h2 {
      margin: 0 0 8px;
      font-weight: 800;
    }

    
    .bonus-head {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin: 0 0 10px;
    }

    .picked-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      min-height: 40px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border, rgba(255, 255, 255, .12));
      background: rgba(255, 255, 255, .04);
      font-weight: 700;
    }

    .picked-pill img {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      object-fit: cover;
      display: block;
    }

    .picked-pill.muted {
      opacity: .7;
      font-weight: 600;
      background: linear-gradient(135deg, rgba(61, 224, 197, .12), rgba(123, 91, 255, .16));
    }

    
    .bonus-wheel {
      position: relative;
      height: 180px;
      
      overflow: hidden;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, 0) 60%);
      margin-top: 6px;
    }

    .bonus-wheel .wheel-track {
      position: relative;
      width: 100%;
      height: 100%;
      touch-action: pan-x;
      user-select: none;
      cursor: grab;
    }

    .bonus-card.dragging .wheel-track {
      cursor: grabbing;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –±–æ–Ω—É—Å–∞ */
    .bonus-wheel .bonus {
      all: unset;
      position: absolute;
      left: 50%;
      top: 50%;
      width: 96px;
      height: 96px;
      border-radius: 16px;
      overflow: hidden;
      transform: translate(-50%, -50%);
      will-change: transform;
      transition: transform .25s ease, filter .25s ease, opacity .25s ease, box-shadow .25s ease;
    }

    .bonus-wheel .bonus img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .bonus-wheel .bonus span {
      position: absolute;
      left: 50%;
      bottom: -22px;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: .85;
      white-space: nowrap;
      pointer-events: none;
    }

    .bonus-wheel .bonus:not(.active) {
      filter: grayscale(.18) brightness(.95);
      opacity: .9;
    }

    .bonus-wheel .bonus.active {
      box-shadow:
        0 0 0 2px rgba(123, 91, 255, .55) inset,
        0 10px 28px rgba(123, 91, 255, .35),
        0 0 22px rgba(61, 224, 197, .25);
    }

    
    .bonus-wheel .wheel-center {
      pointer-events: none;
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(123, 91, 255, .10), transparent 55%);
      mask: linear-gradient(#000 30%, transparent 80%);
    }

    
    .bonus-card .actions {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 8px;
      align-items: center;
    }

    #spinBtn,
    #claimBtn {
      min-height: 40px;
    }

    #claimBtn[disabled] {
      opacity: .6;
      pointer-events: none;
    }

    #picked {
      opacity: .8;
    }

    
    .bonus-head {
      display: flex;
      gap: 12px;
      margin: 0 0 10px;
    }

    .picked-pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border, rgba(255, 255, 255, .12));
      background: rgba(255, 255, 255, .04);
      font-weight: 700;
    }

    .picked-pill.muted {
      opacity: .7;
      font-weight: 600;
    }

   
    .bonus-card .actions {
      margin-top: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      /* [–ö—Ä—É—Ç–∞–Ω—É—Ç—å] [–ó–∞–±—Ä–∞—Ç—å] [‚Äî] */
      gap: 8px;
      align-items: center;
    }

    #spinBtn,
    #claimBtn {
      min-height: 40px;
    }

    #claimBtn[disabled] {
      opacity: .6;
      pointer-events: none;
    }

    #picked {
      opacity: .8;
    }


    
#sheet #pf-prizes-sheet{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  overflow:visible;
}

#sheet #pf-prizes-sheet + .ticker__clone{ display:none; }

  </style>

<style>
 
.toasts{
  position:fixed; right:16px; bottom:calc(env(safe-area-inset-bottom,0px) + 16px);
  z-index:100000; display:grid; gap:8px; width:min(92vw,320px); pointer-events:none;
}
.toast{
  pointer-events:auto; display:flex; align-items:center; gap:10px;
  padding:12px 14px; border-radius:14px; color:#fff;
  background:rgba(18,20,24,.96); border:1px solid rgba(255,255,255,.12);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
  transform:translateX(120%); opacity:0; animation:toast-in .25s ease forwards;
}
.toast--error{ border-color:rgba(255,107,107,.45); box-shadow:0 10px 24px rgba(255,107,107,.15); }
.toast--ok{    border-color:rgba(55,214,122,.45);  box-shadow:0 10px 24px rgba(55,214,122,.15); }
.toast__close{ margin-left:auto; opacity:.7; background:transparent; border:0; color:inherit; cursor:pointer; }
@keyframes toast-in { to { transform:translateX(0); opacity:1; } }
@keyframes toast-out{ to { transform:translateX(120%); opacity:0; } }


#spinBtn.is-locked{ opacity:.6; }
#spinBtn.is-locked:active{ transform:none; }

</style>




<style>
  

.trivia-q{ display:grid; gap:12px; }
.trivia-title{ font-weight:800; }
.trivia-opts{ display:grid; gap:8px; }
.trivia-opt{
  display:flex; align-items:center; gap:10px; padding:12px 14px;
  border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04); cursor:pointer; user-select:none;
  transition:.15s ease;
}
.trivia-opt input{ display:none; }
.trivia-opt.correct{ border-color:rgba(55,214,122,.45); background:rgba(55,214,122,.14); }
.trivia-opt.wrong{   border-color:rgba(255,107,107,.45); background:rgba(255,107,107,.10); }
.trivia-cta{ display:flex; gap:10px; }
.trivia-next{ display:none; }
.trivia-next.show{ display:inline-flex; }
.trivia-muted{ opacity:.8; }
.trivia-cooldown{
  display:flex; align-items:center; justify-content:space-between;
  border:1px dashed rgba(255,255,255,.18); border-radius:12px; padding:12px 14px;
}
.trivia-count{ font-weight:800; }


.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  line-height:1;           
  vertical-align:middle;
  gap:8px;
}


.trivia-cta{ display:flex; align-items:center; gap:10px; } 
.trivia-next.btn{
  height:42px;             
  padding:0 16px;
  font-weight:800;
}


.trivia-next.btn:active{ transform:none; }

.trivia-next.is-hidden{ display:none !important; }


.trivia-q{ display:grid; gap:12px; }
.trivia-title{ font-weight:800; }
.trivia-opts{ display:grid; gap:8px; }
.trivia-opt{
  display:flex; align-items:center; gap:10px; padding:12px 14px;
  border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04); cursor:pointer; user-select:none; transition:.15s ease;
}
.trivia-opt input{ display:none; }
.trivia-opt.correct{ border-color:rgba(55,214,122,.45); background:rgba(55,214,122,.14); }
.trivia-opt.wrong{   border-color:rgba(255,107,107,.45); background:rgba(255,107,107,.10); }

.trivia-cta{ display:flex; gap:10px; }
.trivia-next.is-hidden{ display:none !important; }


.trivia-start{ display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.trivia-start.is-hidden{ display:none !important; }


.trivia-card.is-running .h1 { display: none !important; }

</style>



<style>

.card{ padding:14px; border-radius:16px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.04); }
.section-title{ font-weight:800; }


.pf-hero{ display:grid; grid-template-columns:1fr auto auto; gap:12px; align-items:center; }
.pf-title{ font-weight:800; font-size:18px; }
.pf-hint{ opacity:.7; font-size:12px; }
.pf-ava{ width:56px; height:56px; border-radius:50%; object-fit:cover; background:#222; border:1px solid rgba(255,255,255,.08); }
.pf-balance{ height:36px; padding:0 12px; border-radius:999px; font-weight:800; }


.pill-amber{ background:transparent; color:#ffb02e; border:1.5px solid #ffb02e; }


.profile-block{ display:grid; gap:12px; }
.row{ display:grid; gap:8px; }
.row-title{ font-weight:700; }

.metrics{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; }
.metric{ background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px; }
.metric__val{ font-weight:900; font-size:18px; }
.metric__lbl{ opacity:.75; font-size:12px; }


.chips{ display:flex; flex-wrap:wrap; gap:8px; }
.chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
       background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); font-weight:700; font-size:13px; }
.chip .dot{ width:6px; height:6px; border-radius:50%; background:#ffd166; }


.actions{ display:flex; gap:10px; }
.btn-white{ background:#fff; color:#000; border:1px solid #fff; border-radius:12px; padding:10px 14px; font-weight:800; flex:1; }


@media (max-width:520px){
  .pf-hero{ grid-template-columns:1fr auto; grid-template-areas:"about balance" "about ava"; }
  .pf-about{ grid-area:about; }
  .pf-balance{ grid-area:balance; }
  .pf-ava{ grid-area:ava; }
  .metrics{ grid-template-columns:1fr 1fr; }
}


.pf-hero{
  display:grid;
  grid-template-columns: auto 1fr auto;           /* ‚¨ÖÔ∏è —Ñ–æ—Ç–æ | –∏–º—è | –±–∞–ª–∞–Ω—Å */
  grid-template-areas: "ava about balance";
  gap:12px;
  align-items:center;
}
.pf-ava     { grid-area: ava; }
.pf-about   { grid-area: about; }
.pf-balance { grid-area: balance; justify-self:end; white-space:nowrap; }


@media (max-width:520px){
  .pf-hero{
    grid-template-columns: auto 1fr auto;
    grid-template-areas: "ava about balance";
  }
  .pf-balance{ padding:0 10px; height:34px; font-size:13px; }
}

.card{
  padding:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(255,255,255,.04);
  display:grid;
  gap:12px;
}

.card + .card{ margin-top:12px; }


.card .card{
  margin:0; padding:0; border:0; background:transparent; box-shadow:none;
}


.pf-hero{
  display:grid;
  grid-template-columns:auto 1fr auto;
  grid-template-areas:"ava about balance";
  gap:12px; align-items:center;
}
.pf-ava{ grid-area:ava; width:56px; height:56px; border-radius:30%; object-fit:cover;
         background:#222; border:1px solid rgba(255,255,255,.08); }
.pf-about{ grid-area:about; }
.pf-title{ font-weight:800; font-size:18px; }
.pf-hint{ opacity:.7; font-size:12px; }
.pf-balance{ grid-area:balance; justify-self:end; height:36px; padding:0 12px; border-radius:999px; font-weight:800; }
.pill-amber{ background:transparent; color:#ffb02e; border:1.5px solid #ffb02e; }


.profile-block{ gap:12px; }
.section-title{ font-weight:800; }
.row{ display:grid; gap:8px; }
.row-title{ font-weight:700; }


.metrics{ display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; }
.metric{ background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px; }
.metric__val{ font-weight:900; font-size:18px; }
.metric__lbl{ opacity:.75; font-size:12px; }


.chips{ display:flex; flex-wrap:wrap; gap:8px; }
.chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
       background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); font-weight:700; font-size:13px; }
.chip--muted{ opacity:.6; }


.actions{ display:flex; gap:10px; }
.btn-white{ background:#fff; color:#000; border:1px solid #fff; border-radius:12px; padding:10px 14px; font-weight:800; flex:1; }


@media (max-width:520px){
  .metrics{ grid-template-columns:1fr 1fr; }
  .pf-balance{ padding:0 10px; height:34px; font-size:13px; }
}

.pf-hero{
  display:grid;
  grid-template-columns:auto 1fr auto; /* ava | about | balance */
  gap:12px; align-items:center;
}
.metric--balance{
  justify-self:end;
  padding:8px 12px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  min-width:96px;           
}
.metric--balance .metric__val{ font-weight:900; font-size:18px; line-height:1; }
.metric--balance .metric__lbl{ opacity:.75; font-size:12px; margin-top:2px; }

@media (max-width:520px){
  .metric--balance{ padding:6px 10px; }
  .metric--balance .metric__val{ font-size:16px; }
}

.coin-ico{
  width:14px; height:14px;
  background: var(--coin-url, url('coin.png')) center/contain no-repeat;
  display:inline-block;
  margin-left:14px;
}

.panel{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  border-radius:12px;
  padding:10px;
  display:grid;
  gap:8px;
}
.panel__head{ display:flex; align-items:center; gap:8px; }
.panel__icon{ font-size:16px; line-height:1; }
.panel__title{ font-weight:800; }


.ticker{ overflow:hidden; }
.ticker__track{
  display:inline-flex; gap:8px; white-space:nowrap;
  will-change: transform;
  animation: ticker var(--ticker-dur, 20s) linear infinite;
}
.ticker:hover .ticker__track{ animation-play-state: paused; }
@keyframes ticker{ from{transform:translateX(0)} to{transform:translateX(-50%)} }


.panel .chips{ padding-top:2px; }


@media (prefers-reduced-motion: reduce){ .ticker__track{ animation:none } }

.ticker{ overflow:hidden; position:relative; }
.ticker__track{
  display:inline-flex; gap:8px; white-space:nowrap;
  will-change: transform;
  animation: tickerLoop var(--dur, 0s) linear infinite;
}
.ticker--reverse .ticker__track{ animation-direction: reverse; } /* –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ä–µ–≤–µ—Ä—Å */

@keyframes tickerLoop{
  from{ transform: translateX(0); }
  to  { transform: translateX(calc(-1 * var(--shift, 50%))); }
}


</style>




<style>
:root{ --card-pad:14px; }


.card.passport{
  padding: var(--card-pad);
  border: 1px solid rgba(255,255,255,.12);
  border-radius: 16px;
  background: rgba(255,255,255,.04);
  display: grid;
  grid-template-columns: 160px 1fr;
  gap: 12px;
  align-items: stretch;
}


.passport__media{
  border-radius: 12px;
  overflow: hidden;
  background: rgba(255,255,255,.04);
  display: grid; place-items: center;
}
.passport__media img{
  width:100%; height:100%; object-fit:cover; display:block;
}


.passport__body{ display:grid; gap:10px; }


#passport-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:10px;
}


.pslot{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  border-radius:12px;
  padding:10px;
  display:grid; gap:8px;
  transition: border-color .2s ease, background-color .2s ease, box-shadow .2s ease;
}
.pslot__title{ font-weight:800; line-height:1.2; }


.pslot__badge{
  display:grid; place-items:center;
  padding:8px 10px; border-radius:999px;
  font-weight:800; font-size:13px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; opacity:.95;
}


.pslot.is-done{
  border-color: rgba(55,214,122,.55);
  background: rgba(55,214,122,.12);
  box-shadow: 0 0 0 1px rgba(55,214,122,.25) inset;
}
.pslot.is-done .pslot__title{ color:#37d67a; }
.pslot.is-done .pslot__badge{
  border-color: rgba(55,214,122,.55);
  background: linear-gradient(180deg, rgba(55,214,122,.9), rgba(55,214,122,.75));
  color:#0b1a12;
}


@media (max-width:520px){
  .card.passport{ grid-template-columns: 1fr; }
  .passport__media{
    margin: calc(-1*var(--card-pad)) calc(-1*var(--card-pad)) 10px;
    border-radius: 16px 16px 0 0;
    aspect-ratio: 16/9;
  }
  #passport-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
}

</style>





</head>
<body>

  <canvas id="confetti"></canvas>
  <div class="wrap">
    <nav id="btm-nav" class="btm-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="tab" data-page="home"><img src="ic_home.png" alt=""><span>–ì–ª–∞–≤–Ω–∞—è</span></button>
      <button class="tab" data-page="leaderboard"><img src="ic_services.png" alt=""><span>–¢—É—Ä–Ω–∏—Ä</span></button>
      <button class="tab" data-open-flappy><img src="ic_consult.png" alt=""><span>–ò–≥—Ä–∞—Ç—å</span></button>
      <!-- <button class="tab" data-page="games"><img src="ic_consult.png" alt=""><span>–ò–≥—Ä–∞—Ç—å</span></button> -->
      <button class="tab" data-page="bonuses"><img src="ic_bonus.png" alt=""><span>–ë–æ–Ω—É—Å—ã</span></button>
      <button class="tab" data-page="profile"><img src="ic_about.png" alt=""><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
    </nav>

    <main>


<!-- –¢–û–°–¢ –û–∫–æ—à–∫–æ –ø–æ–ø –∞–ø–ø –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ -->
<div id="toasts" class="toasts" aria-live="polite"></div>





<div id="intro" class="intro" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="intro__wrap">
    <div class="intro__progress" id="intro-progress"></div>

    <div class="intro__stage">
      <div class="intro__slides" id="intro-slides">
        <!-- 1 -->
        <section class="intro__slide active">
          <h2 class="intro__h1">–ü—Ä–∏–≤–µ—Ç –¥—Ä—É–≥!</h2>
          <p class="intro__p">–ó–¥–µ—Å—å –∫—É–ª—å—Ç—É—Ä–∞ –∫—Ä–∞—Ñ—Ç–∞! –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ –∏–≥—Ä—ã, –±–æ–Ω—É—Å—ã –∏ –∑–Ω–∞–Ω–∏–µ –ø–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π.
–ü—Ä–æ–¥–æ–ª–∂–∞—è, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—à—å –≤–æ–∑—Ä–∞—Å—Ç 18+ –∏ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏.</p>
        </section>
        <!-- 2 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h2>
          <p class="intro__p">–ò–≥—Ä–∞–π –≤ ¬´–®–º–µ–ª—è¬ª, –ø—Ä–æ—Ö–æ–¥–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã, —Å–æ–±–∏—Ä–∞–π –ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π.
–ó–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –º–æ–Ω–µ—Ç—ã. –ú–æ–Ω–µ—Ç—ã ‚Äî –∫–æ–ª–µ—Å–æ –±–æ–Ω—É—Å–æ–≤, –º–µ—Ä—á, —Å–Ω–µ–∫–∏, –∫—É–ø–æ–Ω—ã.</p>
        </section>

        
        <section class="intro__slide">
          <h2 class="intro__h1">–ü—Ä–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</h2>
          <p class="intro__p">–ú—ã –ª–æ–∫–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: —Å–≤–µ–∂–µ—Å—Ç—å, –º–∞–ª—ã–µ –ø–∏–≤–æ–≤–∞—Ä–Ω–∏, —Å–µ–∑–æ–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏.
–ï—Å—Ç—å –±–µ–∑–∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏, –¥—Ä—É–∂–∏–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∑–∞–∫—É—Å–∫–∞–º–∏ –∏ –º–µ—Ä—á–µ–º.</p>
        </section>

                
        <section class="intro__slide">
          <h2 class="intro__h1">–û—Ç–ª–∏—á–Ω–æ! –ü–æ–≥–Ω–∞–ª–∏</h2>
          <p class="intro__p">–ü–µ—Ä–≤—ã–π —Å–ø–∏–Ω ‚Äî –≤ –ø–æ–¥–∞—Ä–æ–∫. –í –ø—Ä–æ—Ñ–∏–ª–µ –≤–∏–¥–Ω—ã –±–∞–ª–∞–Ω—Å, –ø—Ä–∏–∑—ã –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã.
–ò–≥—Ä–∞–π —á–µ—Å—Ç–Ω–æ, –±–æ–Ω—É—Å—ã –∑–∞–±–∏—Ä–∞–π –≤ –º–∞–≥–∞–∑–∏–Ω–µ.</p>
        </section>
      </div>
    </div>

    <!-- —Å—é–¥–∞ JS –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω—É–∂–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ -->
    <div id="intro-actions" class="intro__actions"></div>
  </div>
</div>




<div id="flappy" class="flappy" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="flappy__wrap">
    <!-- HUD -->
    <div class="fl-hud">
      <div class="fl-hud__row">
        <div id="fl-score" class="fl-score">0</div>
        <div class="fl-bar"><i id="fl-bar"></i></div>
      </div>
      <div class="fl-stats">
        <div class="fl-stat">
          <i id="fl-coin-ico" class="fl-ico"></i>
          <span id="fl-coin-count">0</span>
        </div>
        <div class="fl-stat fl-shield-wrap">
          <i id="fl-shield-ico" class="fl-ico"></i>
          <div class="fl-shield-bar"><i id="fl-shield-bar"></i></div>
        </div>
      </div>
    </div>

    
    <div id="fl-stage" class="fl-stage">
      <div id="fl-hint" class="fl-hint">–¢–∞–ø–Ω–∏ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>
      <div id="fl-bird" class="fl-bird" aria-label="bird"></div>

      
      <div id="fl-result" class="fl-result" aria-hidden="true">
        <div class="fl-card">
          <div class="fl-cell"><div class="fl-val" id="fl-best">0</div><div class="fl-sub">üéØ –¢–≤–æ–π —Ä–µ–∫–æ—Ä–¥</div></div>
          <div class="fl-cell"><div class="fl-val" id="fl-world">200</div><div class="fl-sub">üèÜ –ú–∏—Ä–æ–≤–æ–π —Ä–µ–∫–æ—Ä–¥</div></div>
          <div class="fl-chev">‚Ä∫</div>
        </div>
      </div>
    </div>

    
    <div id="fl-cta" class="fl-cta">
      <button class="btn" data-open-flappy>–ü–æ–ø—Ä–æ–±—ã–≤–∞—Ç—å –µ—à–µ —Ä–∞–∑</button>
    </div>
  </div>
</div>




 
      <div id="sheet" class="sheet sheet-bottom" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sheet__overlay" data-close-sheet></div>
        <section class="sheet__panel" tabindex="-1">
          <div class="sheet__handle"></div>
          <header class="sheet__header">

            <button class="sheet__close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-close-sheet>‚ùå</button>
          </header>
          <div class="sheet__body" id="sheet-body"></div>
        </section>
      </div>

      


      <template id="tpl-lastpriz">
  <div class="card">
    <div class="h1">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã</div>
    <div id="pf-prizes-sheet">
      <div class="pf-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ.</div>
    </div>
  </div>
</template>


<template id="tpl-passport">
  <div class="card passport">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –∫–∞—Ä—Ç–∏–Ω–∫–∞ -->
    <figure class="passport__media">
      <img src="beer_hero.jpg" alt="–ü–∏–≤–Ω–æ–π –ø–∞—Å–ø–æ—Ä—Ç">
    </figure>

    
    <div class="passport__body">
      <div>
        <div class="h1" style="margin:0 0 6px">–ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π</div>
        <p class="muted-sm" style="margin:0">
          –°–æ–±–µ—Ä–∏ 6 —à—Ç–∞–º–ø–æ–≤: <b>Lager</b>, <b>IPA</b>, <b>Stout</b>, <b>Weizen</b>, <b>Sour</b>, <b>Cider</b> ‚Äî –ø—Ä–∏–∑.
        </p>
      </div>

     
      <div id="passport-grid">
        <div class="pslot" data-code="Lager">
          <div class="pslot__title">Lager</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
        <div class="pslot" data-code="IPA">
          <div class="pslot__title">IPA</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
        <div class="pslot" data-code="Stout">
          <div class="pslot__title">Stout</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
        <div class="pslot" data-code="Weizen">
          <div class="pslot__title">Weizen</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
        <div class="pslot" data-code="Sour">
          <div class="pslot__title">Sour</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
        <div class="pslot" data-code="Cider">
          <div class="pslot__title">Cider</div>
          <div class="pslot__badge">–ù–µ—Ç —à—Ç–∞–º–ø–∞</div>
        </div>
      </div>

      <div class="g g2" style="margin-top:6px">
        <button class="btn btn-primary" data-action="add-stamp">–î–æ–±–∞–≤–∏—Ç—å —à—Ç–∞–º–ø</button>
        <!-- <button class="btn" data-action="reset-passport">–°–±—Ä–æ—Å–∏—Ç—å</button> -->
      </div>
    </div>
  </div>
</template>






<template id="tpl-trivia">
  <div class="card trivia-card">
    <div class="h1">–û—Ç–≤–µ—Ç—å –Ω–∞ 4 –ø—Ä–æ—Å—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—É—á–∏ 100 –º–æ–Ω–µ—Ç</div>

    
    <div class="trivia-start" id="trivia-start">
      <button class="btn btn-primary" data-action="trivia-start">–ù–∞—á–∞—Ç—å</button>
      <span id="trivia-start-hint" class="muted-sm" style="margin-left:8px; display:none"></span>
    </div>

    
    <div id="trivia-body"></div>
  </div>
</template>




      <template id="tpl-ref">
        <div class="card">
          <div class="h1">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
          <p class="muted-sm">–ó–∞ –¥—Ä—É–≥–∞ ‚Äî +100 –º–æ–Ω–µ—Ç. –ó–∞ 3 –¥—Ä—É–∑–µ–π ‚Äî –º–∏–Ω–∏‚Äë–¥–µ–≥—É—Å—Ç–∞—Ü–∏—è.</p>
          <div class="g">
            <input id="ref-link" class="btn" readonly value="" />
            <div class="g g2">
              <button class="btn btn-primary" data-action="copy-ref">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
              <button class="btn" data-action="share-ref">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            </div>
          </div>
        </div>
      </template>




      <section class="page" id="home">
        <div class="hero">
          <img class="hero__media" src="beer_hero.jpg" alt="Beer Hero">
        </div>

        <div class="promo">
          <div class="promo__icon"><img src="beer_cup.png" alt=""></div>
          <div>
            <div class="promo__title">Craft Beer</div>
            <div class="promo__sub">–ö—Ç–æ –º—ã, –≥–¥–µ –º—ã</div>
          </div>
          <button class="promo__btn" data-open-intro
          aria-controls="intro"
          aria-label="–û—Ç–∫—Ä—ã—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥">–û –Ω–∞—Å</button>
        </div>

        <div class="card list-card tight">
          <div class="list-head">–° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å</div>
          <div class="list">
            <div class="list__item">
              <div class="list__icon"><img src="pasport.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–ü–∞—Å–ø–æ—Ä—Ç —Å—Ç–∏–ª–µ–π</div>
                <div class="list__sub">–°–æ–±–µ—Ä–∏ 6 —à—Ç–∞–º–ø–æ–≤ ‚Äî –ø–æ–¥–∞—Ä–æ–∫</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–ü–∏–≤–Ω–æ–π –ü–∞—Å–ø–æ—Ä—Ç" data-tpl="#tpl-passport">‚Ä∫</button>
            </div>
            <div class="list__item">
              <div class="list__icon"><img src="casino-chips.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞</div>
                <div class="list__sub">–ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ–∏ –ø–∏–≤–Ω—ã–µ –∑–Ω–∞–Ω–∏—è</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–í–∏–∫—Ç–æ—Ä–∏–Ω–∞" data-tpl="#tpl-trivia">‚Ä∫</button>
            </div>
            <div class="list__item">
              <div class="list__icon"><img src="fren.png" alt=""></div>
              <div class="list__text">
                <div class="list__title">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</div>
                <div class="list__sub">–î–∞—Ä–∏–º +100 –º–æ–Ω–µ—Ç –∑–∞ –¥—Ä—É–≥–∞</div>
              </div>
              <button class="list__chev-btn" data-open-sheet data-title="–†–µ—Ñ–µ—Ä–∞–ª—ã" data-tpl="#tpl-ref">‚Ä∫</button>
            </div>
          </div>
        </div>

        
<div class="card list-card games tight">
  <div class="list-head">–ò–≥—Ä—ã</div>
  <div class="list">
    
    <div class="list__item">
      <div class="list__icon"><img src="bumblebee.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Bumblebee</div>
        <div class="list__sub">–î–æ–ª–µ—Ç–∏ –¥–æ –Ω–∞—Å –∏ –ø–æ–ª—É—á–∏ –ø—Ä–∏–∑</div>
      </div>

<button class="list__btn list__btn--primary" data-open-flappy>–ò–≥—Ä–∞—Ç—å</button>
    </div>

    
    <div class="list__item">
      <div class="list__icon"><img src="racing.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Night Racing</div>
        <div class="list__sub">–ö–∞—Ç–∞–π—Å—è –∏ –ø—Ä–æ–∫–∞—á–∏–≤–∞–π —Ç–∞—á–∫—É</div>
      </div>

<button class="list__btn list__btn--primary" data-open-runner>C–∫–æ—Ä–æ</button>
    </div>

    
    <div class="list__item">
      <div class="list__icon"><img src="beercard.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Memory cards</div>
        <div class="list__sub">–ù–∞–π–¥–∏ –≤—Å–µ —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã—Å—Ç—Ä–µ–µ</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-runner>–°–∫–æ—Ä–æ</button>

      </div>
</div>
      </section>


      


<section id="leaderboard" class="page" style="display:none">



<div class="card lb-card inner" id="leaderboard">
  <div class="lb-head">
    <div>
      <div class="lb-title">Bumblebee</div>
      <div class="lb-sub">–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</div>
    </div>

    <div class="lb-seg" role="tablist" aria-label="Leaderboard period">
      <button type="button" class="js-lb-mode" data-mode="daily" aria-pressed="true">–î–µ–Ω—å</button>
      <button type="button" class="js-lb-mode" data-mode="all">–í—Å–µ</button>
    </div>
  </div>

  
  <div class="lb-you" id="lb-you">
    <div class="lb-you__avatar" id="lb-you-ava">YOU</div>
    <div class="lb-you__meta">
      <div class="lb-you__name" id="lb-you-name">You</div>
      <div class="lb-sub" id="lb-you-note">best score</div>
    </div>
    <div class="lb-you__score" id="lb-you-score">0</div>
  </div>

  
  <div class="lb-list" id="lb-list">
    <!-- —Å—é–¥–∞ JS —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å—Ç—Ä–æ–∫–∏ -->
  </div>

  <div class="lb-actions">
    <button class="lb-btn" id="lb-refresh" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button>
    <button class="lb-btn lb-btn--primary" type="button" data-open-flappy>–ò–≥—Ä–∞—Ç—å</button>
  </div>
</div>

</section>




  <section class="page" id="bonuses">
    <div class="card page-title">
      <h2 class="h1">–ë–æ–Ω—É—Å—ã</h2>
      <p class="muted-sm">–ö—Ä—É—Ç–∏ –∫–æ–ª–µ—Å–æ –∏ –∑–∞–±–∏—Ä–∞–π –≤—ã–ø–∞–≤—à–∏–π –ø–æ–¥–∞—Ä–æ–∫. –í—Ä–∞—â–µ–Ω–∏–µ 100 –º–æ–Ω–µ—Ç</p>
    </div>

    <div class="card bonus-card">
      <div class="h2"></div>

      
      <div class="bonus-head">
        <div id="pickedPill" class="picked-pill muted">–ù–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∞–Ω—É—Ç—å¬ª</div>
      </div>

      
      <div id="bonusWheel" class="bonus-wheel" aria-live="polite">
        <div class="wheel-track" id="wheelTrack">
          <button class="bonus" data-name="–ö—Ä—É–∂–∫–∞"><img src="beer_cup.png" alt="–ö—Ä—É–∂–∫–∞"><span>–ö—Ä—É–∂–∫–∞</span></button>
          <button class="bonus" data-name="–§—É—Ç–±–æ–ª–∫–∞"><img src="tshirt.png" alt="–§—É—Ç–±–æ–ª–∫–∞"><span>–§—É—Ç–±–æ–ª–∫–∞</span></button>
          <button class="bonus" data-name="–§–∏—Å—Ç–∞—à–∫–∏"><img src="pistachio.png" alt="–§–∏—Å—Ç–∞—à–∫–∏"><span>–§–∏—Å—Ç–∞—à–∫–∏</span></button>
          <button class="bonus" data-name="–°–∫–∏–¥–∫–∞"><img src="bonus4.png" alt="–°–∫–∏–¥–∫–∞"><span>–°–∫–∏–¥–∫–∞</span></button>
          <button class="bonus" data-name="–î–µ–≥—É—Å—Ç–∞—Ü–∏—è"><img src="tongue-out.png" alt="–î–µ–≥—É—Å—Ç–∞—Ü–∏—è"><span>–î–µ–≥—É—Å—Ç–∞—Ü–∏—è</span></button>
          <button class="bonus" data-name="–ú–æ–Ω–µ—Ç—ã"><img src="coin.png"
              alt="–ú–æ–Ω–µ—Ç—ã"><span>–ú–æ–Ω–µ—Ç—ã</span></button>
        </div>
        <div class="wheel-center"></div>
      </div>

      
      <div class="actions">
        <button class="btn btn-primary" id="spinBtn">–ö—Ä—É—Ç–∞–Ω—É—Ç—å</button>
        <button class="btn btn-primary" id="claimBtn" disabled>–ó–∞–±—Ä–∞—Ç—å</button>
      </div>
    </div>
      </section>

      
<section id="profile" class="card profile">
  <!-- ===== PROFILE ¬∑ HERO ===== -->
<!-- ===== PROFILE ¬∑ HERO ===== -->
<section class="card profile-hero">
  <div class="pf-hero">
    <div class="pf-about">
      <div class="pf-title" id="pf-title">–ì–æ—Å—Ç—å</div>
      <div class="pf-hint" id="pf-username"></div>
    </div>

<div class="metric metric--balance">
  <div class="metric__val">
    <span id="pf-coins">0</span>
    <i class="coin-ico" aria-hidden="true"></i>
  </div>
  <div class="metric__lbl"></div>
</div>

    
    <img class="pf-ava" id="pf-ava" alt="">
  </div>
</section>
<div aria-hidden="true" style="height:30px;"></div>


<section class="card profile-block">
  <div class="section-title">üéØ –ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>


  <div class="metrics">
    <div class="metric">
      <div class="metric__val" id="pf-flappy-best">0</div>
      <div class="metric__lbl">–®–º–µ–ª—å ‚Äî –ª—É—á—à–∏–π —Å—á—ë—Ç</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-pass-count">0/6</div>
      <div class="metric__lbl">–ü–∞—Å–ø–æ—Ä—Ç ‚Äî —à—Ç–∞–º–ø—ã</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-pass-list">‚Äî</div>
      <div class="metric__lbl">–ü–æ–ª—É—á–µ–Ω—ã</div>
    </div>
        <div class="metric">
      <div class="metric__val" id="pf-refs-count">0</div>
      <div class="metric__lbl">–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</div>
    </div>
  </div>
</section>

<div aria-hidden="true" style="height:25px;"></div>



<section class="card profile-block">
  <div class="section-title">üèÜ –¢—É—Ä–Ω–∏—Ä</div>

  <div class="metrics">
    <div class="metric">
      <div class="metric__val" id="pf-today-rank">‚Äî</div>
      <div class="metric__lbl">–ú–µ—Å—Ç–æ —Å–µ–≥–æ–¥–Ω—è</div>
    </div>
    <div class="metric">
      <div class="metric__val" id="pf-all-rank">‚Äî</div>
      <div class="metric__lbl">All-time</div>
    </div>

  </div>


  <div aria-hidden="true" style="height:19px;"></div>

<div class="panel panel--prizes">
  <div class="panel__head">
 
    <div class="panel__title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã</div>
  </div>
  <div class="ticker js-ticker">
    <div class="chips ticker__track" id="pf-prizes">
      <span class="chip chip--muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</span>
    </div>
    <div class="chips ticker__track ticker__clone" aria-hidden="true"></div>
  </div>
</div>




</section>



    </main>
  </div>

  <script>
  (function app(){
    const TG = window.Telegram && window.Telegram.WebApp;
    if (TG){
      try{ TG.ready(); TG.expand(); TG.disableVerticalSwipes?.(); TG.enableClosingConfirmation?.(); TG.onEvent?.('viewportChanged', () => TG.disableVerticalSwipes?.()); }catch(e){ console.warn('TG init error', e); }
    }

    const ROOT = 'home';
    const sheetRoot = document.getElementById('sheet');
    const sheetPanel= sheetRoot?.querySelector('.sheet__panel');
    const sheetBody = document.getElementById('sheet-body');
    const sheetTitle= sheetRoot?.querySelector('.sheet__title');

    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const isInDOM = id => !!document.getElementById(id);

    function currentId(){
      const url = new URL(location.href);
      const qp = (url.searchParams.get('page') || '').trim();
      if (qp && isInDOM(qp)) return qp;
      const h = (location.hash || '#'+ROOT).replace(/^#/, '');
      return isInDOM(h) ? h : ROOT;
    }
    function setActivePage(id){
      qsa('main > section, section.page').forEach(s => {
        const on = (s.id === id);
        s.classList.toggle('active', on);
        s.style.display = on ? 'block' : 'none';
      });
      qsa('[data-page]').forEach(t => t.classList.toggle('active', t.dataset.page === id));
      requestAnimationFrame(()=> window.scrollTo({ top: 0, behavior:'auto' }));
      syncBack();
    }
    function navigateTo(id){
      if (!id || !isInDOM(id)) return;
      const h = '#'+id;
      if (h !== (location.hash || '#'+ROOT)){ history.pushState({id}, '', h); }
      setActivePage(id);
    }

    function showBack(){ try{ TG?.BackButton?.show && TG.BackButton.show(); }catch(_){ } }
    function hideBack(){ try{ TG?.BackButton?.hide && TG.BackButton.hide(); }catch(_){ } }
    function syncBack(){
      if (!TG) return;
      const atRoot = (currentId() === ROOT);
      const sheetOpen = sheetRoot?.classList.contains('is-open');
      if (sheetOpen || !atRoot) showBack(); else hideBack();
    }

    TG?.BackButton?.onClick?.(()=>{ if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; } const atRoot = (currentId() === ROOT); if (!atRoot) history.back(); });
    TG?.onEvent?.('backButtonClicked', ()=>{ if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; } const atRoot = (currentId() === ROOT); if (!atRoot) history.back(); });
    window.addEventListener('popstate', ()=> setActivePage(currentId()));

    function haptic(level='light'){ try{ TG?.HapticFeedback?.impactOccurred && TG.HapticFeedback.impactOccurred(level); } catch(_){ try{ navigator.vibrate && navigator.vibrate(level==='light'?10:16); }catch(_){} } }
    function openSheet({title='', html='', from='bottom'} = {}){
      if (!sheetRoot) return;
      sheetRoot.classList.toggle('sheet-bottom', from==='bottom');
      if (sheetTitle) sheetTitle.textContent = title || '';
      if (sheetBody && html != null) sheetBody.innerHTML = html;
      sheetRoot.classList.add('is-open'); document.body.classList.add('sheet-open');
      requestAnimationFrame(()=> sheetPanel?.focus({preventScroll:true}));
      haptic('light'); syncBack();
    }
    function closeSheet(){ if (!sheetRoot) return; sheetRoot.classList.remove('is-open'); document.body.classList.remove('sheet-open'); haptic('light'); syncBack(); }
    window.openSheet = openSheet; window.closeSheet = closeSheet;
    sheetRoot?.addEventListener('click', (e)=>{ if (e.target.closest('[data-close-sheet]')) closeSheet(); });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && sheetRoot?.classList.contains('is-open')) closeSheet(); });

    // Prevent iOS pull-to-refresh when no TG.disableVerticalSwipes
    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    if (isiOS && !(TG && typeof TG.disableVerticalSwipes === 'function')){
      let startY = 0; document.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, {passive:true});
      document.addEventListener('touchmove', e => { const dy = e.touches[0].clientY - startY; const atTop = (window.scrollY <= 0); if (dy > 0 && atTop){ e.preventDefault(); } }, {passive:false});
    }

    
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext('2d');
    function resizeCanvas(){ confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight; }
    window.addEventListener('resize', resizeCanvas); resizeCanvas();
    function confettiBurst(n=140, duration=900){
      const parts = Array.from({length:n},()=>({
        x: Math.random()*confettiCanvas.width,
        y: -10,
        vx: (Math.random()-0.5)*4,
        vy: Math.random()*3+2,
        r: Math.random()*3+1,
        a: 1
      }));
      const t0 = performance.now();
      function frame(t){
        const dt = (t - (confettiBurst._lt||t))/16; confettiBurst._lt = t;
        ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
        parts.forEach(p=>{ p.x+=p.vx*dt; p.y+=p.vy*dt; p.a -= 0.01*dt; ctx.globalAlpha = Math.max(0,p.a); ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle = ['#f9b24d','#f29117','#ffd59c','#fff'][p.r|0 % 4]; ctx.fill(); });
        if (t - t0 < duration){ requestAnimationFrame(frame); } else { ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height); }
      }
      requestAnimationFrame(frame);
    }

    
    const APP = {
      BOT_USERNAME: 'your_bot_username', // TODO: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ @–∏–º—è_–±–æ—Ç–∞
      WORKER_BASE: 'https://your-worker.example.dev/', // TODO: –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Worker
      API_KEY: 'dev-123',
      COOLDOWN_SPIN_HOURS: 24,
      MAX_TRIVIA: 5,
    };
    const store = {
      get(k,def){ try{ return JSON.parse(localStorage.getItem(k)) ?? def; }catch(_){ return def }},
      set(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
      now(){ return Date.now(); }
    };
    const SKEY = {
      coins: 'beer_coins',
      spinAt: 'beer_spin_next',
      rewards: 'beer_rewards',
      passport: 'beer_passport',
      visits: 'beer_visits',
      trivia: 'beer_trivia',
    };
    function addCoins(n){ const c = Math.max(0, (store.get(SKEY.coins,0) + n)|0); store.set(SKEY.coins,c); syncCoins(); }
    function coins(){ return store.get(SKEY.coins,0)|0; }

    function syncCoins(){
      qsa('#coins,#coins-inline,#coins-profile').forEach(el=> el && (el.textContent = coins()));
      const lvl = levelFromCoins(coins());
      const pct = Math.min(100, (coins() % 1000)/10);
      const lvlEl = document.getElementById('level'); if (lvlEl) lvlEl.textContent = lvl;
      const lm = document.getElementById('lvl-meter'); if (lm) lm.style.width = pct+'%';
      const cm = document.getElementById('coin-meter'); if (cm) cm.style.width = Math.min(100, coins()/10)+'%';
    }
    function levelFromCoins(c){ if (c >= 3000) return 'Gold'; if (c >= 1500) return 'Silver'; return 'Bronze'; }

    
    document.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('[data-open-sheet]');
      if (openBtn){ e.preventDefault(); const tplSel = openBtn.dataset.tpl || ''; const tpl = tplSel ? document.querySelector(tplSel) : null; const html = tpl ? tpl.innerHTML : ''; const ttl = openBtn.getAttribute('title') || openBtn.dataset.title || openBtn.textContent.trim() || ''; const from = openBtn.dataset.from || 'bottom'; openSheet({ title: ttl, html, from }); initSheet(ttl); return; }
      const tab = e.target.closest('[data-page]'); if (tab){ e.preventDefault(); navigateTo(tab.dataset.page); }

      
      const act = e.target.closest('[data-action]')?.dataset.action;
      if (!act) return;
      switch(act){
        case 'start-cap': startCapToss(); break;
        case 'cap-help': alert('–°–≤–∞–π–ø–∞–π, —á—Ç–æ–±—ã –±—Ä–æ—Å–∞—Ç—å. –ö–æ–º–±–æ –∏ ¬´Foam Frenzy¬ª –ø–æ–∑–∂–µ –ø—Ä–∏–∫—Ä—É—Ç–∏–º.'); break;
        case 'spin': handleSpin(); break;
        case 'add-stamp': addStampPrompt(); break;
        case 'reset-passport': resetPassport(); break;
        case 'submit-trivia': submitTrivia(); break;
        case 'reset-trivia': resetTrivia(); break;
        case 'copy-ref': copyRef(); break;
        case 'share-ref': shareRef(); break;
        case 'add-visit': addVisit(); break;
      }
    });

    
    const start = currentId(); history.replaceState({id:start}, '', '#'+start); setActivePage(start);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 0);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 300);

    
    (function fillUser(){
      const u = TG?.initDataUnsafe?.user; const name = u ? (u.first_name + (u.last_name? (' ' + u.last_name) : '')) : '–ì–æ—Å—Ç—å';
      const nameEl = document.getElementById('user-name'); if (nameEl) nameEl.textContent = name;
    })();

    
    function initSheet(title){
      if (/–ø–∞—Å–ø–æ—Ä—Ç/i.test(title)) renderPassport();
      if (/–∫–æ–ª–µ—Å–æ/i.test(title)) initSpin();
      if (/—Ä–µ—Ñ–µ—Ä–∞–ª|–¥—Ä—É–∑/i.test(title)) initRef();
      if (/–≤–∏–∫—Ç–æ—Ä–∏–Ω/i.test(title)) renderTrivia();
      if (/–≤–∏–∑–∏—Ç/i.test(title)) renderVisits();
      if (/cap toss/i.test(title)) initCapUI();
      syncCoins();
    }


    
    function logReward(rec){ const r = store.get(SKEY.rewards,[]); r.unshift({ts:Date.now(),...rec}); store.set(SKEY.rewards,r); renderRewards(); }
    function renderRewards(){
      const r = store.get(SKEY.rewards,[]); const box = document.getElementById('rewards-feed'); if (!box) return;
      if (!r.length){ box.textContent='–ü–æ–∫–∞ –ø—É—Å—Ç–æ'; return; }
      box.innerHTML = r.slice(0,8).map(x=>`<div>‚Ä¢ ${new Date(x.ts).toLocaleString()} ‚Äî ${x.source}: <b>${x.prize}</b></div>`).join('');
    }

    
    const STYLES = ['Lager','IPA','Stout','Weizen','Sour','Cider'];
    function renderPassport(){
      const data = store.get(SKEY.passport, {});
      const grid = document.getElementById('passport-grid'); if (!grid) return;
      grid.innerHTML = STYLES.map(s=>{
        const c = data[s]||0; const done = c>0 ? 'badge badge--green' : 'badge';
        return `<div class="card" style="text-align:center"><div style="font-weight:800">${s}</div><div class="${done}" style="margin-top:6px">${c>0?'–®—Ç–∞–º–ø –µ—Å—Ç—å':'–ù–µ—Ç —à—Ç–∞–º–ø–∞'}</div></div>`;
      }).join('');
    }
    function addStampPrompt(){
      const style = prompt('–ö–∞–∫–æ–π —Å—Ç–∏–ª—å? (Lager, IPA, Stout, Weizen, Sour, Cider)'); if (!style) return;
      const S = style.trim(); if (!STYLES.includes(S)) return alert('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∏–ª—å');
      const pin = prompt('PIN —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–¥–µ–º–æ: 1111)'); if (pin !== '1111') return alert('PIN –Ω–µ–≤–µ—Ä–Ω—ã–π');
      const data = store.get(SKEY.passport, {}); data[S] = 1; store.set(SKEY.passport, data); renderPassport(); addCoins(100); confettiBurst(); logReward({source:'passport', prize:'–®—Ç–∞–º–ø '+S});
    }
    function resetPassport(){ store.set(SKEY.passport, {}); renderPassport(); }


    
    function initRef(){
      const u = TG?.initDataUnsafe?.user; const uid = u?.id || Math.floor(Math.random()*1e9);
      const code = 'beer_ref_'+uid;
      const link = `https://t.me/${APP.BOT_USERNAME}?start=${code}`;
      const input = document.getElementById('ref-link'); if (input) input.value = link;
    }
    async function copyRef(){ const el = document.getElementById('ref-link'); if(!el) return; el.select(); document.execCommand?.('copy'); try{ await navigator.clipboard.writeText(el.value); }catch{} haptic('light'); }
    async function shareRef(){ const el = document.getElementById('ref-link'); if(!el) return; const txt = '–ó–∞–ª–µ—Ç–∞–π –≤ –ø–∏–≤–Ω–æ–π –º–∏–Ω–∏‚Äë–∞–ø–ø –∏ –∑–∞–±–µ—Ä–∏ –ø—Ä–∏–∑! '+el.value; try{ await navigator.share?.({text:txt}); }catch{ try{ await navigator.clipboard.writeText(el.value);}catch{} } haptic('light'); }



    
    syncCoins(); renderRewards();
  })();
  </script>

  <script>
(function introSlider(){
  const TG = window.Telegram && window.Telegram.WebApp;

  
  const INTRO_CFG = {
    actions: {
      0: [ // –°–ª–∞–π–¥ 1 ‚Äî –¥–≤–µ —Ä—è–¥–æ–º
        { label:'–ù–µ—Ç', type:'ghost', do:'navigate', value:'no' },
        { label:'–ï—Å—Ç—å 18',  type:'primary', do:'answer', to:'next' } // –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ó–∞–ø–∏—Å—å"
      ],
      1: [ // –°–ª–∞–π–¥ 0 ‚Äî –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
        { label:'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do:'next' }
      ],
      2: [ // –°–ª–∞–π–¥ 2 ‚Äî –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
        { label:'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do:'next' }
      ],
      3: [ // –°–ª–∞–π–¥ 3 ‚Äî –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
        { label:'–ò–≥—Ä–∞—Ç—å', type:'ghost', do:'navigate' }
      ]
      // –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–ª–∞–π–¥–æ–≤:
      // 3: [
      //   { label:'–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç', type:'primary', do:'link', href:'https://example.com' }
      // ],
      // 4: [
      //   { label:'–ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ', type:'primary', do:'sheet', title:'–î–µ–º–æ', tpl:'#tpl-example', from:'bottom' }
      // ]
    },
    onAnswer: (index, value) => {
      // –¢–≤–æ–π —Ö—É–∫ –Ω–∞ –æ—Ç–≤–µ—Ç—ã "–î–∞/–ù–µ—Ç" –∏ —Ç.–ø.
      // –ù–∞–ø—Ä–∏–º–µ—Ä: localStorage.setItem('intro_answer_'+index, value);
      // console.log('Answer on slide', index, '=>', value);
    }
  };

  
  const root = document.getElementById('intro');
  if(!root) return;

  const slidesWrap = root.querySelector('#intro-slides');
  const slides = Array.from(root.querySelectorAll('.intro__slide'));
  const progress = root.querySelector('#intro-progress');
  const actions = root.querySelector('#intro-actions');

  
  progress.innerHTML = slides.map(()=>'<i class="intro__seg"></i>').join('');
  const segs = Array.from(progress.children);

  let idx = 0, touchX0=0, touchX=0, dragging=false, backHandler=null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };

  
  function btnHTML(cfg){
    const cls = ['intro__btn'];
    if (cfg.type === 'primary') cls.push('intro__btn--primary');
    if (cfg.type === 'ghost')   cls.push('intro__btn--ghost');
    const attrs = [];
    if (cfg.do) attrs.push(`data-act="${cfg.do}"`);
    if (cfg.value != null) attrs.push(`data-val="${String(cfg.value)}"`);
    if (cfg.to)    attrs.push(`data-to="${String(cfg.to)}"`);
    if (cfg.href)  attrs.push(`data-href="${String(cfg.href)}"`);
    if (cfg.title) attrs.push(`data-title="${String(cfg.title)}"`);
    if (cfg.tpl)   attrs.push(`data-tpl="${String(cfg.tpl)}"`);
    if (cfg.from)  attrs.push(`data-from="${String(cfg.from)}"`);
    return `<button class="${cls.join(' ')}" ${attrs.join(' ')}>${cfg.label}</button>`;
  }

  
  function renderActions(){
    const set = INTRO_CFG.actions[idx] || defaultActions();
    // —Å–µ—Ç–∫–∞: 1 / 2 / 3+
    actions.className = 'intro__actions';
    if (set.length === 1) actions.classList.add('intro__actions--one');
    else if (set.length === 2) actions.classList.add('intro__actions--two');
    else actions.classList.add('intro__actions--multi'); // —Å–º. CSS –Ω–∏–∂–µ
    actions.innerHTML = set.map(btnHTML).join('');
  }

  
  function defaultActions(){
    const last = (idx === slides.length - 1);
    return [ { label: last ? '–ì–æ—Ç–æ–≤–æ' : '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do: last ? 'done' : 'next' } ];
    
  }

  function apply(){
    slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
    segs.forEach((d,i)=> d.classList.toggle('active', i<=idx));
    renderActions();
  }

  
  function openIntro(startIndex){
    if (Number.isInteger(startIndex)) idx = Math.max(0, Math.min(startIndex, slides.length-1));
    root.classList.add('is-open');
    document.body.classList.add('intro-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeIntro();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
    }catch(_){}

    apply();
    window.syncBack?.();
  }
  function closeIntro(){
    root.classList.remove('is-open');
    document.body.classList.remove('intro-open');

    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  function next(){ if(idx<slides.length-1){ idx++; apply(); haptic(); } }
  function prev(){ if(idx>0){ idx--; apply(); haptic(); } }

  
  slidesWrap.addEventListener('touchstart', e=>{ dragging=true; touchX0=touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchmove',  e=>{ if(!dragging) return; touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchend',   ()=>{ if(!dragging) return; dragging=false;
    const dx = touchX - touchX0; if (Math.abs(dx)>50){ dx<0 ? next() : prev(); }
  });

  
  actions.addEventListener('click', (e)=>{
    const b = e.target.closest('[data-act]'); if(!b) return;
    const act  = b.getAttribute('data-act');
    const val  = b.getAttribute('data-val');
    const to   = b.getAttribute('data-to');
    const href = b.getAttribute('data-href');
    const title= b.getAttribute('data-title');
    const tpl  = b.getAttribute('data-tpl');
    const from = b.getAttribute('data-from') || 'bottom';

    switch(act){
      case 'next': next(); break;
      case 'prev': prev(); break;
      case 'done': haptic('medium'); closeIntro(); break;
      case 'answer':
        try{ INTRO_CFG.onAnswer && INTRO_CFG.onAnswer(idx, val); }catch(_){}
        next(); break;
      case 'navigate':
        closeIntro();
        if (typeof window.navigateTo === 'function') window.navigateTo(to);
        else if (to) location.hash = '#'+to;
        break;
      case 'link':
        try{ TG?.openLink ? TG.openLink(href) : window.open(href, '_blank'); }catch(_){}
        break;
      case 'sheet':
        closeIntro();
        if (typeof window.openSheet === 'function'){
          const tplNode = tpl ? document.querySelector(tpl) : null;
          const html = tplNode ? tplNode.innerHTML : '<div class="card"><b>–ù–µ—Ç —à–∞–±–ª–æ–Ω–∞</b></div>';
          window.openSheet({ title, html, from });
        }
        break;
    }
  });

  
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-intro]');
    if (!t) return;
    e.preventDefault();
    const start = parseInt(t.getAttribute('data-open-intro'), 10);
    openIntro(Number.isFinite(start) ? start : undefined);
  });

  
  window.openIntro  = openIntro;
  window.closeIntro = closeIntro;
})();
</script>


<script>

(function flappyLitePlus(){
  const TG = window.Telegram && window.Telegram.WebApp;

  
  const root   = document.getElementById('flappy'); if (!root) return;
  const stage  = document.getElementById('fl-stage');
  const birdEl = document.getElementById('fl-bird');
  const hintEl = document.getElementById('fl-hint');
  const scoreEl= document.getElementById('fl-score');
  const barEl  = document.getElementById('fl-bar');

  const coinIco= document.getElementById('fl-coin-ico');
  const coinCnt= document.getElementById('fl-coin-count');
  const shIco  = document.getElementById('fl-shield-ico');
  const shBar  = document.getElementById('fl-shield-bar');

  const resBox = document.getElementById('fl-result');
  const bestEl = document.getElementById('fl-best');
  const worldEl= document.getElementById('fl-world');
  const cta    = document.getElementById('fl-cta');

  
  const ASSETS = {
    bird:   { img: 'bumblebee.png',  w: 56, h: 42 },
    pipes:  { top:'pipe_top.png', bottom:'pipe_bottom.png', width:54 },
    coin:   { img:'coin.png',   w:32, h:32, value:5 },
    shield: { img:'shield.png', w:34, h:34, dur_ms:6000 }
  };

  
  const WORLD_RECORD     = 200;
  const GRAVITY          = 1800;
  const FLAP_VELOCITY    = -520;
  const SPEED_X          = 220;
  const ACCEL_EACH_MS    = 8000;
  const SPEED_STEP       = 28;
  const PIPE_SPAWN_MS    = 1300;
  const GAP_MIN          = 150;
  const GAP_MAX          = 190;
  const GAP_TOP_PAD      = 80;
  const BIRD_X_FACTOR    = 0.25;
  const ROT_UP           = -35, ROT_DOWN = 90;
  const SAFE_FLOOR_PAD   = 6;

  
  const COIN_IN_GAP_PROB = 0.9;
  const SHIELD_PROB      = 0.9;
  const SHIELD_COOLDOWN  = 9000;

  
  const MAGNET_ENABLED   = true;
  const MAGNET_RADIUS    = 140;
  const MAGNET_PULL_PX_S = 300;

  
  let best     = Number(localStorage.getItem('flappy_best')||0);
  let running  = false, started=false;
  let raf      = 0, spawnT = Infinity, t0 = 0, backOff=null; // PATCH: spawnT=Infinity, t0=0
  let w=0,h=0, birdX=0, birdY=0, birdVY=0;

  let pipes=[];   // {x, gapY, gap, topEl, botEl, passed:false}
  let items=[];   // [{type:'coin'|'shield', x,y, el}]
  let lastShieldSpawn = 0;

  let score=0, coins=0;
  let shieldActive=false, shieldUntil=0;

  
const WALLET_KEY = 'beer_coins';
function getWallet(){ return +(localStorage.getItem(WALLET_KEY)||0); }
function setWallet(v){ localStorage.setItem(WALLET_KEY, String(Math.max(0, v|0))); try{ window.syncCoinsUI?.(); }catch(_){ } }
// –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ: –µ—Å–ª–∏ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å window.addCoins ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ.
function addWallet(n){ if (typeof window.addCoins==='function') return window.addCoins(n|0); setWallet(getWallet()+(n|0)); }
const COIN_TO_WALLET = 1; // 1 –ø–æ–¥–æ–±—Ä–∞–Ω–Ω–∞—è –º–æ–Ω–µ—Ç–∫–∞ = 1 –≤ –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å (–ø–æ–º–µ–Ω—è–π –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏)


  
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const clamp  = (v,a,b)=> Math.max(a, Math.min(b, v));
  const rand   = (a,b)=> a + Math.random()*(b-a);

  
  function applyAssets(){
    document.documentElement.style.setProperty('--bird-w', (ASSETS.bird.w||48)+'px');
    document.documentElement.style.setProperty('--bird-h', (ASSETS.bird.h||36)+'px');
    if (ASSETS.bird.img){
      birdEl.classList.add('fl-bird--sprite');
      birdEl.style.backgroundImage = `url(${ASSETS.bird.img})`;
    } else {
      birdEl.classList.remove('fl-bird--sprite'); birdEl.style.backgroundImage = '';
    }
    document.documentElement.style.setProperty('--pipe-w', (ASSETS.pipes.width||76)+'px');
    if (ASSETS.coin.img)   coinIco.style.backgroundImage = `url(${ASSETS.coin.img})`;
    if (ASSETS.shield.img) shIco.style.backgroundImage = `url(${ASSETS.shield.img})`;
    document.documentElement.style.setProperty('--coin-w', (ASSETS.coin.w||32)+'px');
    document.documentElement.style.setProperty('--coin-h', (ASSETS.coin.h||32)+'px');
    document.documentElement.style.setProperty('--pow-w',  (ASSETS.shield.w||34)+'px');
    document.documentElement.style.setProperty('--pow-h',  (ASSETS.shield.h||34)+'px');
  }

  
  function layout(){
    w = stage.clientWidth; h = stage.clientHeight;
    birdX = w * BIRD_X_FACTOR;
    if (!started){ birdY = h * 0.45; applyBird(); }
  }
  function applyBird(){ birdEl.style.left = birdX + 'px'; birdEl.style.top = birdY + 'px'; }
  function setScore(v){ scoreEl.textContent = v; }
  function setCoins(v){ coinCnt.textContent = v; }

  
  function spawnPipe(){
    const gap = rand(GAP_MIN, GAP_MAX);
    const minY = GAP_TOP_PAD + gap/2;
    const maxY = h - GAP_TOP_PAD - gap/2;
    const gapY = rand(minY, maxY);

    const top = document.createElement('div');
    const bot = document.createElement('div');
    top.className = 'fl-pipe-part';
    bot.className = 'fl-pipe-part';
    if (ASSETS.pipes.top && ASSETS.pipes.bottom){
      top.classList.add('fl-pipe--sprite'); bot.classList.add('fl-pipe--sprite');
      top.style.backgroundImage = `url(${ASSETS.pipes.top})`;
      bot.style.backgroundImage = `url(${ASSETS.pipes.bottom})`;
    }
    stage.appendChild(top); stage.appendChild(bot);

    const p = { x: w + (ASSETS.pipes.width||76), gapY, gap, topEl: top, botEl: bot, passed:false };
    pipes.push(p);
    positionPipe(p);

    
    if (Math.random() < COIN_IN_GAP_PROB){
      const c = document.createElement('div');
      c.className = 'fl-coin';
      if (ASSETS.coin.img) c.style.backgroundImage = `url(${ASSETS.coin.img})`;
      stage.appendChild(c);
      items.push({ type:'coin', x: p.x + 200, y: gapY, el: c });
      positionItem(items[items.length-1]);
    }

    
    if (Date.now() - lastShieldSpawn > SHIELD_COOLDOWN && Math.random() < SHIELD_PROB){
      const s = document.createElement('div');
      s.className = 'fl-power';
      if (ASSETS.shield.img) s.style.backgroundImage = `url(${ASSETS.shield.img})`;
      stage.appendChild(s);
      items.push({ type:'shield', x: p.x + 300, y: gapY - gap*0.35, el: s });
      positionItem(items[items.length-1]);
      lastShieldSpawn = Date.now();
    }
  }

  function positionPipe(p){
    const pipeW = (ASSETS.pipes.width||76);
    const th = p.gapY - p.gap/2;
    const bt = p.gapY + p.gap/2;
    p.topEl.style.left = p.x + 'px';
    p.topEl.style.top  = '0px';
    p.topEl.style.height = th + 'px';
    p.topEl.style.width  = pipeW + 'px';
    p.botEl.style.left = p.x + 'px';
    p.botEl.style.top  = bt + 'px';
    p.botEl.style.height = (h - bt) + 'px';
    p.botEl.style.width  = pipeW + 'px';
  }

  function positionItem(it){ it.el.style.left = it.x + 'px'; it.el.style.top  = it.y + 'px'; }
  function removePipe(p){ p.topEl.remove(); p.botEl.remove(); }
  function removeItem(it){ it.el.remove(); }

  
  function rectsOverlap(a,b){ return !(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom); }
  function collidePipe(){
    const br = birdEl.getBoundingClientRect();
    for (const p of pipes){
      if (rectsOverlap(br, p.topEl.getBoundingClientRect()) || rectsOverlap(br, p.botEl.getBoundingClientRect())) return true;
    }
    return false;
  }
  function collideItems(){
    const br = birdEl.getBoundingClientRect();
    const dead=[];
    for (let i=0;i<items.length;i++){
      const it = items[i];
      const ir = it.el.getBoundingClientRect();
      if (rectsOverlap(br, ir)){
        if (it.type==='coin'){
          coins += 1; setCoins(coins);
          score += (ASSETS.coin.value||5); setScore(score);
          haptic('medium');
        } else if (it.type==='shield'){
          activateShield();
          haptic('medium');
        }
        removeItem(it); dead.push(i);
      }
    }
    for (let i=dead.length-1;i>=0;i--) items.splice(dead[i],1);
  }

  
  function activateShield(){
    shieldActive = true;
    shieldUntil  = Date.now() + (ASSETS.shield.dur_ms||6000);
    birdEl.classList.add('fl-bird--shield');
  }
  function updateShieldHud(){
    if (!shieldActive){ shBar.style.transform = 'scaleX(0)'; return; }
    const left = shieldUntil - Date.now();
    if (left <= 0){
      shieldActive = false; birdEl.classList.remove('fl-bird--shield');
      shBar.style.transform = 'scaleX(0)';
    } else {
      const pct = clamp(left / (ASSETS.shield.dur_ms||6000), 0, 1);
      shBar.style.transform = `scaleX(${pct})`;
    }
  }

  
  function flap(){
    if (!running) return;
    if (!started){
      
      started = true;
      hintEl.style.display = 'none';
      birdVY = FLAP_VELOCITY;
      t0 = performance.now();        
      spawnT = t0;                   
      tick._prev = t0;               
    } else {
      birdVY = FLAP_VELOCITY;
    }
    haptic('light');
  }

  // loop
  function tick(){
    const now = performance.now();
    const dt  = Math.min(32, now - (tick._prev||now)); tick._prev = now;

    
    if (!started){
      birdY += Math.sin(now/300) * 0.12;  
      applyBird();
      updateShieldHud();
      raf = requestAnimationFrame(tick);
      return;
    }

    
    const elapsed = now - t0;
    const prog = Math.min(1, elapsed / 45000);
    barEl.style.transform = `scaleX(${1-prog})`;

    
    const speed = SPEED_X + Math.floor(elapsed / ACCEL_EACH_MS) * SPEED_STEP;

    
    birdVY += GRAVITY * (dt/1000);
    birdY  += birdVY * (dt/1000);
    const ang = clamp((birdVY/600)*45, ROT_UP, ROT_DOWN);
    birdEl.style.transform = `translate(-50%,-50%) rotate(${ang}deg)`;

    const topLimit = 6;
    const botLimit = h - SAFE_FLOOR_PAD;
    if (birdY <= topLimit){ birdY = topLimit; birdVY = 0; }
    if (birdY >= botLimit){ birdY = botLimit; if (!shieldActive){ crash(); return; } else { birdVY = -200; } }

    
    const dx = speed * dt/1000;
    for (const p of pipes){ p.x -= dx; positionPipe(p); }
    for (const it of items){
      it.x -= dx;
      if (MAGNET_ENABLED && shieldActive && it.type === 'coin'){
        const vx=birdX-it.x, vy=birdY-it.y, dist=Math.hypot(vx,vy);
        if (dist < MAGNET_RADIUS){
          const pull = MAGNET_PULL_PX_S * (dt/1000);
          const step = Math.min(pull, dist||0);
          const nx = vx/(dist||1), ny = vy/(dist||1);
          it.x += nx*step; it.y += ny*step;
          it.el.style.transform = 'translate(-50%,-50%) scale(1.08)';
        } else it.el.style.transform = 'translate(-50%,-50%)';
      } else it.el.style.transform = 'translate(-50%,-50%)';
      positionItem(it);
    }

    
    for (const p of pipes){
      if (!p.passed && p.x + (ASSETS.pipes.width||76) < birdX){
        p.passed = true; score += 1; setScore(score); haptic('light');
      }
    }

    
    while (pipes.length && pipes[0].x < -(ASSETS.pipes.width||76)-2){ removePipe(pipes[0]); pipes.shift(); }
    while (items.length && items[0].x < -80){ removeItem(items[0]); items.shift(); }

    
    collideItems();
    if (collidePipe()){
      if (shieldActive){
        shieldActive = false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';
        birdVY = -260;
      } else { crash(); return; }
    }

    
    if (now - spawnT > PIPE_SPAWN_MS){ spawnT = now; spawnPipe(); }

    
    applyBird();
    updateShieldHud();

    raf = requestAnimationFrame(tick);
  }

  function crash(){ haptic('heavy'); finish(); }
  function finish(){
    running=false; cancelAnimationFrame(raf);
    if (score > best){ best=score; try{ localStorage.setItem('flappy_best', String(best)); }catch(_){ } }

    
    try { window.Tournament?.submit(score); } catch(_) {}

    addWallet(Math.floor(coins * COIN_TO_WALLET)); // –∑–∞—á–∏—Å–ª—è–µ–º –≤—Å–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∑–∞ —Ä–∞—É–Ω–¥


    document.getElementById('fl-best').textContent = best;
    document.getElementById('fl-world').textContent = WORLD_RECORD;
    resBox.classList.add('show'); cta.classList.add('show');
  }

  function resetScene(){
    
    pipes.forEach(removePipe); pipes = [];
    items.forEach(removeItem); items = [];
    coins=0; setCoins(0);
    shieldActive=false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';

    
    started=false; score=0; setScore(0);
    hintEl.style.display = '';
    birdVY = 0; birdEl.style.transform = 'translate(-50%,-50%) rotate(0deg)';
    barEl.style.transform = 'scaleX(1)';      // PATCH: –±–∞—Ä –ø–æ–ª–Ω—ã–π –Ω–∞ —Å—Ç–∞—Ä—Ç–µ
    layout();

    
    spawnT = Infinity;
    tick._prev = performance.now();
  }

  function openFlappy(){
    root.classList.add('is-open'); document.body.classList.add('flappy-open');
    try{
      TG?.BackButton?.show?.(); backOff = ()=> closeFlappy();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    resBox.classList.remove('show'); cta.classList.remove('show');

    applyAssets();
    layout(); resetScene();

    running = true;
    
    raf = requestAnimationFrame(tick);
  }

  function closeFlappy(){
    running=false; cancelAnimationFrame(raf);
    root.classList.remove('is-open'); document.body.classList.remove('flappy-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  
  stage.addEventListener('pointerdown', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  document.addEventListener('keydown', (e)=>{
    if (!root.classList.contains('is-open')) return;
    if (e.code==='Space' || e.key==='ArrowUp'){ e.preventDefault(); flap(); }
    if (e.key==='Escape'){ closeFlappy(); }
  });

  
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closeFlappy(); openFlappy();
  });

  
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-flappy]'); if (!t) return;
    e.preventDefault(); openFlappy();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-flappy]')) closeFlappy();
  });

  
  new ResizeObserver(()=> layout()).observe(stage);
})();
</script>











<script>
(function () {
  const wheel = document.getElementById('bonusWheel');
  const track = document.getElementById('wheelTrack');
  if (!wheel || !track) return;

  const items = Array.from(track.children);
  const N = items.length;

  const pill  = document.getElementById('pickedPill');
  const claim = document.getElementById('claimBtn');
  const spin  = document.getElementById('spinBtn');

  
  const bonusLinks = {
    "–ö—Ä—É–∂–∫–∞": "#tpl-lastpriz",
    "–§—É—Ç–±–æ–ª–∫–∞": "#tpl-lastpriz",
    "–§–∏—Å—Ç–∞—à–∫–∏": "#tpl-lastpriz",
    "–°–∫–∏–¥–∫–∞": "#tpl-lastpriz",
    "–î–µ–≥—É—Å—Ç–∞—Ü–∏—è": "#tpl-lastpriz",
    "–ú–æ–Ω–µ—Ç—ã": "#tpl-lastpriz"
  };

  
  let STEP = 114; 
  requestAnimationFrame(() => {
    const a = items[0]?.getBoundingClientRect();
    const b = items[1]?.getBoundingClientRect();
    if (a && b) {
      const dx = Math.round(b.left - a.left);
      if (dx > 40 && dx < 300) STEP = dx;
    }
  });

  let curr = 0; 
  let startX = 0, startCurr = 0, dragging = false, lastX = 0, lastT = 0, vel = 0;
  let interacted = false; // —Å—Ç–∞–Ω–µ—Ç true –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
  let spinning = false;   // –±–ª–æ–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

  const mod = (a, n) => ((a % n) + n) % n;
  const easeOut = t => 1 - Math.pow(1 - t, 3);
  function nearest(curr, idx, n) {
    let t = idx;
    while (t - curr > n / 2) t -= n;
    while (curr - t > n / 2) t += n;
    return t;
  }

  
  const TG = window.Telegram && window.Telegram.WebApp;
  function hapticPulse(level = 'light') {
    try {
      if (TG?.HapticFeedback) {
        if (level === 'selection') return TG.HapticFeedback.selectionChanged();
        TG.HapticFeedback.impactOccurred(level); // 'soft' | 'light' | 'medium' | 'heavy' | 'rigid'
        return;
      }
    } catch (_) {}
    try { if (navigator.vibrate) { navigator.vibrate(level === 'heavy' ? 30 : level === 'medium' ? 20 : 12); } } catch (_) {}
  }

  
  const COOLDOWN_MS = 0.1 * 60 * 60 * 1000; // 24 —á–∞—Å–∞
  const UID = (TG?.initDataUnsafe?.user?.id) || 'anon';
  const CLAIM_KEY = 'bonusClaim_ts_' + UID;

  function getLastClaim() { return +(localStorage.getItem(CLAIM_KEY) || 0); }
  function setLastClaim(ts = Date.now()) { localStorage.setItem(CLAIM_KEY, String(ts)); }
  function remainingMs() { return Math.max(0, getLastClaim() + COOLDOWN_MS - Date.now()); }
  function fmtClock(ms) {
    const s = Math.floor(ms / 1000);
    const h = Math.floor(s / 3600);
    const m = Math.floor((s % 3600) / 60);
    const ss = s % 60;
    return String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(ss).padStart(2, '0');
  }

  let claimTimerId = null;
  function refreshClaimState() {
    if (!claim) return;

    const rem = remainingMs();
    const canClaim = interacted && rem <= 0;

    if (canClaim) {
      claim.disabled = false;
      claim.textContent = '–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å';
      if (claimTimerId) { clearInterval(claimTimerId); claimTimerId = null; }
    } else {
      claim.disabled = true;
      if (interacted && rem > 0) {
        claim.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ' + fmtClock(rem);
        if (!claimTimerId) {
          claimTimerId = setInterval(() => {
            const r = remainingMs();
            if (r > 0) claim.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ' + fmtClock(r);
            else {
              clearInterval(claimTimerId); claimTimerId = null;
              claim.textContent = '–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å';
              claim.disabled = !interacted;
            }
          }, 1000);
        }
      } else {
        claim.textContent = '–ó–∞–±—Ä–∞—Ç—å –±–æ–Ω—É—Å';
        if (claimTimerId) { clearInterval(claimTimerId); claimTimerId = null; }
      }
    }
  }

  
  function updatePillByIndex(idx) {
    const it = items[idx];
    const name = it?.dataset?.name || '‚Äî';
    const img = it?.querySelector('img')?.src || '';
    if (!pill) return;
    pill.classList.remove('muted');
    pill.innerHTML = img ? `<img src="${img}" alt=""><span>${name}</span>` : name;
    if (claim) {
      claim.disabled = false;
      claim.dataset.bonus = name;
    }
  }

  function updateUI() {
    
    items.forEach((el, i) => {
      let dx = i - curr;
      dx = mod(dx + N / 2, N) - N / 2; // (-N/2; N/2]
      const x = dx * STEP;
      const s = 1 - Math.min(Math.abs(dx) * 0.16, 0.48);
      el.style.transform = `translate(-50%,-50%) translateX(${x}px) scale(${s})`;
      el.style.zIndex = String(1000 - Math.abs(dx) * 10);
      el.classList.toggle('active', Math.round(Math.abs(dx)) === 0);
    });

    if (interacted) {
      updatePillByIndex(mod(Math.round(curr), N));
    } else {
      if (pill) { pill.classList.add('muted'); pill.textContent = '–ù–∞–∂–º–∏ ¬´–ö—Ä—É—Ç–∞–Ω—É—Ç—å¬ª'; }
      if (claim) { claim.disabled = true; delete claim.dataset.bonus; }
    }

    
    refreshClaimState();
    syncCoinsUI();
  }

  
  function spinTo(targetIdx, laps = 1, dur = 1600) {
    const base = nearest(curr, targetIdx, N);
    const dir = (base >= curr ? 1 : -1) || 1;
    const to = base + dir * (laps * N);

    const from = curr, t0 = performance.now();
    let lastPulse = 0;

    function tick(t) {
      const k = Math.min((t - t0) / dur, 1);
      curr = from + (to - from) * (1 - Math.pow(1 - k, 3)); // easeOut
      updateUI();

      
      const period = 80 + 180 * k; // 80ms ‚Üí 260ms
      if (t - lastPulse >= period) { hapticPulse('light'); lastPulse = t; }

      if (k < 1) {
        requestAnimationFrame(tick);
      } else {
        curr = to;
        interacted = true;
        updateUI();
      }
    }
    requestAnimationFrame(tick);
  }

  function snapTo(targetIdx, dur = 420) {
    const to = nearest(curr, targetIdx, N);
    const from = curr;
    const t0 = performance.now();
    function tick(t) {
      const k = Math.min((t - t0) / dur, 1);
      curr = from + (to - from) * easeOut(k);
      updateUI();
      if (k < 1) requestAnimationFrame(tick);
      else { curr = to; interacted = true; updateUI(); }
    }
    requestAnimationFrame(tick);
  }

  
  const COIN_KEY = 'beer_coins';
  const SPIN_COST = 1;

  function getCoins(){ return +(localStorage.getItem(COIN_KEY) || 0); }
  function setCoins(v){
    v = Math.max(0, v|0);
    localStorage.setItem(COIN_KEY, String(v));
    syncCoinsUI();
  }
  function addCoins(n){ setCoins(getCoins() + (n|0)); }

  function syncCoinsUI(){
    ['coins-inline','coins-inline-2','coins-profile'].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.textContent = getCoins();
    });
    if (spin){
      const lock = (getCoins() < SPIN_COST) || spinning;
      spin.classList.toggle('is-locked', lock);
     
    }
  }


  if (getCoins() === 0) addCoins(300);


  function ensureToastStyles(){
    if (document.getElementById('toast-styles')) return;
    const css = `
.toasts{
  position:fixed; right:16px; bottom:calc(env(safe-area-inset-bottom,0px) + 16px);
  z-index:100000; display:grid; gap:8px; width:min(92vw,320px); pointer-events:none;
}
.toast{
  pointer-events:auto; display:flex; align-items:center; gap:10px;
  padding:12px 14px; border-radius:14px; color:#fff;
  background:rgba(18,20,24,.96); border:1px solid rgba(255,255,255,.12);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
  transform:translateX(120%); opacity:0; animation:toast-in .25s ease forwards;
}
.toast--error{ border-color:rgba(255,107,107,.45); box-shadow:0 10px 24px rgba(255,107,107,.15); }
.toast--ok{    border-color:rgba(55,214,122,.45);  box-shadow:0 10px 24px rgba(55,214,122,.15); }
.toast__close{ margin-left:auto; opacity:.7; background:transparent; border:0; color:inherit; cursor:pointer; }
@keyframes toast-in { to { transform:translateX(0); opacity:1; } }
@keyframes toast-out{ to { transform:translateX(120%); opacity:0; } }


#spinBtn.is-locked{ opacity:.6; }
#spinBtn.is-locked:active{ transform:none; }


#confetti { position: fixed; left:0; top:0; width:100%; height:100%; pointer-events:none; overflow:visible; z-index:10000; }
.confetti-piece{ position: fixed; left: var(--x); top: var(--y); width:8px; height:8px; border-radius:2px; transform: translate(-50%,-50%); animation: confetti-fall .95s ease-out forwards; }
@keyframes confetti-fall { to { transform: translate(calc(var(--dx)), calc(var(--dy))) rotate(260deg); opacity:0; } }
`;
    const style = document.createElement('style');
    style.id = 'toast-styles';
    style.textContent = css;
    document.head.appendChild(style);
  }

  function showToast(msg, type='error', ms=3000){
    ensureToastStyles();
    const host = document.getElementById('toasts') || (()=>{
      const d=document.createElement('div'); d.id='toasts'; d.className='toasts';
      document.body.appendChild(d); return d;
    })();
    const el = document.createElement('div');
    el.className = 'toast' + (type==='ok' ? ' toast--ok' : ' toast--error');
    el.innerHTML = `<span>${msg}</span><button class="toast__close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>`;
    host.appendChild(el);
    const close = ()=>{ el.style.animation='toast-out .22s ease forwards'; setTimeout(()=> el.remove(), 240); };
    el.querySelector('.toast__close').addEventListener('click', close);
    setTimeout(close, ms);
  }


  
  spin?.addEventListener('click', () => {
    if (spinning) return;

    if (getCoins() < SPIN_COST) {
      hapticPulse('medium');
      showToast(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç. –ù—É–∂–Ω–æ ${SPIN_COST} ü™ô`, 'error', 3000);
      return;
    }

    
    setCoins(getCoins() - SPIN_COST);
    hapticPulse('light');

    
    spinning = true;
    const idx = Math.floor(Math.random() * N);
    spinTo(idx, 1, 1600);

    
    const r = spin.getBoundingClientRect();
    confettiBurst(r.left + r.width / 2, r.top + r.height / 2);

    
    setTimeout(() => {
      spinning = false;
      syncCoinsUI();
    }, 1650);
  });

 
claim?.addEventListener('click', () => {
  if (claim.disabled) return;

  const idx  = mod(Math.round(curr), N);
  const name = items[idx]?.dataset?.name || '';

  
  setLastClaim();
  refreshClaimState();

  
  try {
    window.Profile?.incPoints?.(100);
    window.Profile?.setPrize?.(name);
  } catch (_) {}

  
  window.openLastPrizesSheet();
});


 
  function confettiBurst(x, y) {
    ensureToastStyles(); // —Ç—É—Ç —Ç–∞–∫–∂–µ –ª–µ–∂–∏—Ç CSS –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    let layer = document.getElementById('confetti');
    if (!layer) { layer = document.createElement('div'); layer.id = 'confetti'; document.body.appendChild(layer); }
    const colors = ['#7b5bff', '#3de0c5', '#ffd166', '#ef476f', '#06d6a0', '#118ab2'];
    const rect = document.body.getBoundingClientRect();
    const ox = (x ?? rect.width / 2), oy = (y ?? rect.height / 3);
    for (let i = 0; i < 36; i++) {
      const el = document.createElement('div');
      el.className = 'confetti-piece';
      el.style.background = colors[i % colors.length];
      const angle = (i / 36) * Math.PI * 2;
      const speed = 140 + Math.random() * 120;
      const dx = Math.cos(angle) * speed, dy = Math.sin(angle) * speed + 220;
      el.style.setProperty('--x', ox + 'px');
      el.style.setProperty('--y', oy + 'px');
      el.style.setProperty('--dx', dx + 'px');
      el.style.setProperty('--dy', dy + 'px');
      layer.appendChild(el);
      setTimeout(() => el.remove(), 950);
    }
  }

  /* —Å—Ç–∞—Ä—Ç */
  updateUI();          
  refreshClaimState(); 
  syncCoinsUI();       
})();
</script>


  
<script>
(function(){
  'use strict';

  
  const QUESTIONS = [
    { q:'–ö–∞–∫–æ–π —Å—Ç–∏–ª—å –æ–±—ã—á–Ω–æ —Å–∞–º—ã–π —Ö–º–µ–ª—å–Ω–æ–π –∏ –∞—Ä–æ–º–∞—Ç–Ω—ã–π —Ü–∏—Ç—Ä—É—Å–æ–º?', opts:['IPA','Lager','Weizen','Stout'], ok:0 },
    { q:'–£ –∫–∞–∫–æ–≥–æ —Å—Ç–∏–ª—è –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ –∫–æ—Ñ–µ–π–Ω–æ-—à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –Ω–æ—Ç—ã?',     opts:['Sour','Stout','Pilsner','Cider'], ok:1 },
    { q:'–ü—à–µ–Ω–∏—á–Ω—ã–π –Ω–µ–º–µ—Ü–∫–∏–π —Å—Ç–∏–ª—å —Å –±–∞–Ω–∞–Ω–æ–º/–≥–≤–æ–∑–¥–∏–∫–æ–π ‚Äî —ç—Ç–æ‚Ä¶',    opts:['Weizen','Porter','APA','Saison'], ok:0 },
    { q:'–ö–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å ‚Äî —Ñ–∏—à–∫–∞ —Å—Ç–∏–ª—è‚Ä¶',                             opts:['Sour','Bock','Amber','Doppelbock'], ok:0 },
  ];
  const REWARD = 100;                    
  const COOLDOWN_MS = 0.1*60*60*1000;     

 
  const TG = window.Telegram && window.Telegram.WebApp;
  function haptic(level){ try{ TG?.HapticFeedback?.impactOccurred(level||'light'); }catch(_){ navigator.vibrate?.(10); } }

  
  const COIN_KEY = 'beer_coins';
  function getCoins(){ return +(localStorage.getItem(COIN_KEY)||0); }
  function setCoins(v){ localStorage.setItem(COIN_KEY, String(Math.max(0,v|0))); try{ window.syncCoinsUI?.(); }catch(_){ } }
  function addCoins(n){ if (typeof window.addCoins==='function') return window.addCoins(n); setCoins(getCoins()+(n|0)); }
  function logPrize(txt){ try{ window.logReward?.({source:'trivia', prize:txt}); }catch(_){ } }

  
  const UID = TG?.initDataUnsafe?.user?.id || 'anon';
  const QUIZ_ID = 'beer_trivia_v1';
  const LAST_KEY = `${QUIZ_ID}_last_finish_${UID}`;
  const now = ()=>Date.now();
  const getLast=()=>+(localStorage.getItem(LAST_KEY)||0);
  const setLast=(ts=now())=> localStorage.setItem(LAST_KEY, String(ts));
  const remain=()=> Math.max(0, getLast()+COOLDOWN_MS - now());
  const fmt=(ms)=>{ const s=Math.floor(ms/1000),h=String(Math.floor(s/3600)).padStart(2,'0'),m=String(Math.floor((s%3600)/60)).padStart(2,'0'),ss=String(s%60).padStart(2,'0'); return `${h}:${m}:${ss}`; };

 
  const S = { i:0, canNext:false, timer:null };

  
  const elBody  = ()=> document.getElementById('trivia-body');
  const elStart = ()=> document.getElementById('trivia-start');
  const elHint  = ()=> document.getElementById('trivia-start-hint');

  const rootCard = () => document.getElementById('trivia-body')?.closest('.trivia-card');


 
  function renderStartRow(){
    const start = elStart(), hint = elHint();
    if (!start) return;

    const left = remain();
    start.classList.remove('is-hidden');

    if (left>0){
      const btn = start.querySelector('[data-action="trivia-start"]');
      if (btn){ btn.disabled = true; }
      if (hint){ hint.style.display='inline'; hint.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ' + fmt(left); }
     
      clearInterval(S.timer);
      S.timer = setInterval(()=>{
        const r = remain();
        if (r>0){ if (hint) hint.textContent = '–î–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ ' + fmt(r); }
        else{
          clearInterval(S.timer); S.timer=null;
          if (btn) btn.disabled = false;
          if (hint) hint.style.display='none';
        }
      }, 1000);
    }else{
     
      const btn = start.querySelector('[data-action="trivia-start"]');
      if (btn) btn.disabled = false;
      if (hint) hint.style.display='none';
      clearInterval(S.timer); S.timer=null;
    }
  }

  function renderQuestion(){
    const box = elBody(); if (!box) return;
    const q = QUESTIONS[S.i];
    const total = QUESTIONS.length;
    S.canNext = false;

    box.innerHTML =
      `<div class="trivia-q">
         <div class="trivia-title">–í–æ–ø—Ä–æ—Å ${S.i+1} –∏–∑ ${total}: ${q.q}</div>
         <div class="trivia-opts">
           ${q.opts.map((t,idx)=>`
             <label class="trivia-opt" data-idx="${idx}">
               <input type="radio" name="ans" value="${idx}">
               <span>${t}</span>
             </label>`).join('')}
         </div>
         <div class="trivia-cta">
           <button class="btn btn-primary trivia-next is-hidden" data-action="trivia-next" disabled>–î–∞–ª–µ–µ</button>
         </div>
       </div>`;
  }

  function renderFinish(){
    const box = elBody(); if (!box) return;
    box.innerHTML =
      `<div class="trivia-q">
         <div class="trivia-title"></div>
         <p>–í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. –ù–∞ —Å—á—ë—Ç –∑–∞—á–∏—Å–ª–µ–Ω–æ <b>${REWARD} ü™ô</b>.</p>
       </div>`;
  }

 
  function startQuiz(){
    rootCard()?.classList.add('is-running'); // —Å–ø—Ä—è—Ç–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫

   
    elStart()?.classList.add('is-hidden');
   
    clearInterval(S.timer); S.timer=null;
  
    S.i=0; S.canNext=false; renderQuestion();
  }

  function finishQuiz(){
    addCoins(REWARD);
    logPrize(`+${REWARD}ü™ô –∑–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É`);
    setLast(); haptic('light');

    renderFinish();

    
    setTimeout(renderStartRow, 1400);
    rootCard()?.classList.remove('is-running'); 

  }

  
  document.addEventListener('click', (e)=>{
    const body = elBody();
    // —Å—Ç–∞—Ä—Ç
    if (e.target.closest?.('[data-action="trivia-start"]')){
      e.preventDefault();
      if (remain()>0) return; 
      startQuiz();
      return;
    }
    if (!body) return;

   
    const opt = e.target.closest?.('.trivia-opt');
    if (opt && body.contains(opt)){
      const pick = +opt.dataset.idx;
      const ok   = QUESTIONS[S.i].ok;

      body.querySelectorAll('.trivia-opt').forEach(el=> el.classList.remove('wrong','correct'));

      const nextBtn = body.querySelector('.trivia-next');
      if (pick===ok){
        opt.classList.add('correct');
        body.querySelectorAll('.trivia-opt').forEach(el=> el.style.pointerEvents='none');
        if (nextBtn){ nextBtn.classList.remove('is-hidden'); nextBtn.disabled=false; }
        S.canNext=true; haptic('light');
      }else{
        opt.classList.add('wrong');
        if (nextBtn){ nextBtn.classList.add('is-hidden'); nextBtn.disabled=true; }
        S.canNext=false; haptic('medium');
      }
      return;
    }

    
    if (e.target.closest?.('[data-action="trivia-next"]')){
      e.preventDefault();
      if (!S.canNext) return;
      if (S.i < QUESTIONS.length-1){ S.i++; renderQuestion(); }
      else { finishQuiz(); }
    }
  });

 
  function mountIfReady(){
    const body = elBody(), start = elStart();
    if (body && start){
     
      renderStartRow();
      body.innerHTML = ''; 
      return true;
    }
    return false;
  }

 
  if (!mountIfReady()){
    
    const mo = new MutationObserver(()=>{ if (mountIfReady()) mo.disconnect(); });
    mo.observe(document.body, {childList:true, subtree:true});
  }

 
  window.mountTrivia = function(){ renderStartRow(); elBody().innerHTML=''; };

})();
</script>

<script>

(function(){
  const TG = window.Telegram && window.Telegram.WebApp;

  const LB = {
    GAME: 'flappy',
    dayKey(){ return new Date().toISOString().slice(0,10); },
    k(mode){ return `lb_${this.GAME}_` + (mode==='daily' ? this.dayKey() : 'all'); },
    read(mode){ try{return JSON.parse(localStorage.getItem(this.k(mode))||'[]')}catch(_){return[]} },
    write(mode,arr){ localStorage.setItem(this.k(mode), JSON.stringify(arr)); },

    submit(score){
      const u = TG?.initDataUnsafe?.user || {};
      const uid = u.id || 'anon';
      const name = u.first_name ? (u.first_name + (u.last_name? ' '+u.last_name : '')) : 'Guest';

      
      ['daily','all'].forEach(mode=>{
        const list = this.read(mode);
        const i = list.findIndex(r=>r.uid===uid);
        if (i === -1) list.push({uid,name,score,ts:Date.now()});
        else if (score > list[i].score){ list[i].score = score; list[i].ts = Date.now(); list[i].name = name; }
        list.sort((a,b)=> b.score - a.score);
        this.write(mode, list.slice(0,100)); // top100
      });

      
      try{
        const base = (window.APP&&APP.WORKER_BASE) || (window.APP_CONFIG&&APP_CONFIG.WORKER_BASE);
        const key  = (window.APP&&APP.API_KEY)     || (window.APP_CONFIG&&APP_CONFIG.API_KEY);
        if (base){
          const headers = {'content-type':'application/json'}; if (key) headers['x-api-key']=key;
          const body = (mode)=> JSON.stringify({game:this.GAME, mode, score, user:u});
          fetch(base+'games/submit', {method:'POST', headers, body: body('daily')});
          fetch(base+'games/submit', {method:'POST', headers, body: body('all')});
        }
      }catch(_){}
    },

    me(mode){
      const uid = TG?.initDataUnsafe?.user?.id || 'anon';
      return this.read(mode).find(r=>r.uid===uid) || null;
    },
    top(mode){ return this.read(mode).slice(0,20); }
  };

  function esc(s){ return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }

  function render(mode){
    mode = mode || document.querySelector('.js-lb-mode[aria-pressed="true"]')?.dataset.mode || 'daily';
    const list = LB.top(mode);
    const me   = LB.me(mode);

    const meName  = document.getElementById('lb-you-name');
    const meScore = document.getElementById('lb-you-score');
    const box     = document.getElementById('lb-list');

    if (meName){
      const u = TG?.initDataUnsafe?.user;
      meName.textContent = u ? `${u.first_name}${u.last_name?' '+u.last_name:''}` : 'You';
    }
    if (meScore) meScore.textContent = me?.score || 0;

    if (!box) return;
    if (!list.length){ box.innerHTML = '<div class="muted-sm">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°—ã–≥—Ä–∞–π —Ä–∞—É–Ω–¥!</div>'; return; }

    box.innerHTML = list.map((r,i)=>`
      <div class="lb-row ${i<3 ? ('lb-medal-'+(i+1)) : ''}">
        <div class="lb-rank">${i+1}</div>
        <div class="lb-avatar">${esc((r.name||'U').slice(0,1))}</div>
        <div class="lb-name">${esc(r.name||'‚Äî')}</div>
        <div class="lb-score">${r.score}</div>
      </div>
    `).join('');
  }

  
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('.js-lb-mode');
    if (t){
      document.querySelectorAll('.js-lb-mode').forEach(b=> b.setAttribute('aria-pressed', String(b===t)));
      render(t.dataset.mode);
    }
    if (e.target.id === 'lb-refresh') render();
  });

  
  function auto(){ if ((location.hash||'#').slice(1)==='leaderboard') render(); }
  window.addEventListener('hashchange', auto);
  auto();

  
  window.Tournament = { submit:(score)=> LB.submit(score), render:()=>render() };
})();
</script>



<script>
(function(){
  'use strict';
  const TG = (window.Telegram && window.Telegram.WebApp) || null;

 
  const WALLET_KEY   = 'beer_coins';
  const PRIZES_KEY   = 'bonus_log_v1';          // [{name, ts}]
  const PASSPORT_KEY = 'beer_passport_v1';      // {stamps:[]}
  const FLAPPY_BEST  = 'flappy_best';
  const LB_DAILY_KEY = ()=>'lb_flappy_' + new Date().toISOString().slice(0,10);
  const LB_ALL_KEY   ='lb_flappy_all';
  const REFS_KEY     ='beer_refs_v1';

 
  const getJSON = (k,def)=>{ try{ return JSON.parse(localStorage.getItem(k) || ''); }catch(_){ return def; } };
  const setJSON = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
  const fmtDate = ts => new Date(ts).toLocaleDateString();
  const esc = s => String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));

  
  function renderHead(){
    const u = TG?.initDataUnsafe?.user || {};
    const name = [u.first_name, u.last_name].filter(Boolean).join(' ') || '–ì–æ—Å—Ç—å';
    const uname = u.username ? '@'+u.username : '';
    const photo = u.photo_url || '';

    document.getElementById('pf-title').textContent = name;
    document.getElementById('pf-username').textContent = uname;
    const ava = document.getElementById('pf-ava');
    if (photo){ ava.src = photo; ava.alt = name; } else { ava.removeAttribute('src'); ava.alt=''; }
  }

  
  function renderCoins(){
    document.getElementById('pf-coins').textContent = +(localStorage.getItem(WALLET_KEY)||0);
  }

 
  function renderPrizes(){
    const wrap = document.getElementById('pf-prizes');
    const log = getJSON(PRIZES_KEY, []) || [];
    if (!log.length){ wrap.innerHTML = '<div class="pf-muted">–ü–æ–∫–∞ –ø—É—Å—Ç–æ.</div>'; return; }
    wrap.innerHTML = log.slice(0,6).map(x =>
      `<div class="pf-item"><i class="pf-dot"></i><div>üéÅ ${esc(x.name)}</div><div class="pf-muted">üìÖ ${fmtDate(x.ts)}</div></div>`
    ).join('');
  }

  
  function renderFlappy(){
    const best = +(localStorage.getItem(FLAPPY_BEST)||0);
    document.getElementById('pf-flappy-best').textContent = best;

    const me = String(TG?.initDataUnsafe?.user?.id || 'anon');
    const daily = getJSON(LB_DAILY_KEY(), []) || [];
    const all   = getJSON(LB_ALL_KEY,    []) || [];

    const ixToday = daily.findIndex(r=> String(r.uid) === me);
    const ixAll   = all.findIndex  (r=> String(r.uid) === me);

    document.getElementById('pf-flappy-rank').textContent = ixToday>=0 ? (ixToday+1) : '‚Äî';
    document.getElementById('pf-today-rank').textContent  = ixToday>=0 ? (ixToday+1) : '‚Äî';
    document.getElementById('pf-all-rank').textContent    = ixAll>=0   ? (ixAll+1)   : '‚Äî';
  }


  
  function renderRefs(){
    const list = getJSON(REFS_KEY, []) || [];
    document.getElementById('pf-refs-count').textContent = list.length;
    const box = document.getElementById('pf-refs-list');
    if (!list.length){ box.innerHTML = '<div class="pf-muted">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö.</div>'; return; }
    box.innerHTML = list.slice(-5).reverse().map(r =>
      `<div class="pf-item"><i class="pf-dot"></i><div>${esc(r.name||('ID '+r.uid))}</div><div class="pf-muted">¬∑ ${fmtDate(r.ts)}</div></div>`
    ).join('');
  }

 
  function bindInvite(){
    const btn = document.getElementById('pf-invite'); if (!btn) return;
    btn.onclick = ()=>{
      try{
        const uid = TG?.initDataUnsafe?.user?.id || '';
        const startParam = `ref_${uid||Math.random().toString(36).slice(2,7)}`;
        const bot = (window.APP&&APP.BOT) || (window.APP_CONFIG&&APP_CONFIG.BOT) || 'your_bot';
        TG?.openTelegramLink?.(`https://t.me/${bot}/app?startapp=${startParam}`);
      }catch(_){}
    };
  }

  
  window.Profile = {
    incPoints(n){ // +–º–æ–Ω–µ—Ç—ã
      const cur = +(localStorage.getItem(WALLET_KEY)||0);
      localStorage.setItem(WALLET_KEY, String(Math.max(0, cur + (n|0))));
      renderCoins(); try{ window.syncCoinsUI?.(); }catch(_){}
    },
    setPrize(name){ // –ª–æ–≥ –ø—Ä–∏–∑–∞
      const log = getJSON(PRIZES_KEY, [])||[];
      log.unshift({name, ts: Date.now()});
      setJSON(PRIZES_KEY, log.slice(0,30));
      renderPrizes();
    },
    addReferral(user){ // —Ä–µ—Ñ–µ—Ä–∞–ª
      const list = getJSON(REFS_KEY, [])||[];
      const uid  = user?.id || ('u'+Math.random().toString(36).slice(2,7));
      if (!list.find(x=>x.uid===uid)){
        list.push({uid, name: [user?.first_name,user?.last_name].filter(Boolean).join(' ') || ('User '+uid), ts:Date.now()});
        setJSON(REFS_KEY, list);
      }
      renderRefs();
    },
    refresh(){ renderHead(); renderCoins(); renderPrizes(); renderFlappy(); renderPassport(); renderRefs(); }
  };

  
  window.syncCoinsUI = renderCoins;

 
  function initProfilePage(){
    renderHead(); renderCoins(); renderPrizes(); renderFlappy(); renderPassport(); renderRefs(); bindInvite();
  }
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initProfilePage);
  else initProfilePage();
})();
</script>

<script>
  
  window.openLastPrizesSheet = function(){
    const tpl  = document.getElementById('tpl-lastpriz');
    const html = tpl ? tpl.innerHTML : '<div class="card"><div class="h1">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã</div><div id="pf-prizes-sheet"></div></div>';

    window.openSheet({ title: '–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–∏–∑—ã', html, from: 'bottom' });

    
    const src = document.getElementById('pf-prizes');
    const dst = document.getElementById('pf-prizes-sheet');
    if (src && dst) dst.innerHTML = src.innerHTML;
  };
</script>






</body>
</html>
